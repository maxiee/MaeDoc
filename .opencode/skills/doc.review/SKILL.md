# doc.review

> **Skill ID**：`doc.review`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：对已生成的文档进行多维度审阅，输出问题列表、修改建议与优先级

---

## 触发条件

当用户说出以下类似意图时，激活本 Skill：

- "帮我审阅这篇文档"
- "检查一下这个文档有什么问题"
- "对这份文档做质量审查"
- "review 一下这个文档"
- 或由 `/review` 命令内部调用

---

## 输入

本 Skill 需要以下信息（如未提供，按照"缺失信息处理"步骤主动收集）：

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `document` | 是 | 待审阅的文档内容或文件路径 |
| `doc_type` | 否 | 文档类型（`type_id`），如 `tech-design`、`blog-post`；未指定则仅按通用规范审阅 |
| `focus_areas` | 否 | 重点审阅维度（如"只检查逻辑一致性"），未指定则全维度审阅 |

---

## 执行步骤

### 步骤 1：准备阶段

1. 读取待审阅文档，识别文档标题、结构、章节列表
2. 如提供了 `doc_type`，读取对应规范：
   - `docs/_templates/{type_id}/type.json`（章节结构要求）
   - `docs/_templates/{type_id}/guidelines.md`（类型专属写作规范）
3. 读取通用写作规范：`docs/_templates/writing-guidelines.md`
4. 确认审阅维度：按 `focus_areas` 参数或默认执行全维度审阅

### 步骤 2：多维度审阅

按以下五个维度依次审阅，发现问题时记录到问题列表：

#### 维度 1：结构完整性

检查文档的骨架是否符合要求：

- 若有对应 `doc_type`：必需章节（`required: true`）是否全部存在？章节顺序是否与类型定义一致？
- 若无对应 `doc_type`：文档是否有明确的层级结构（标题 H1→H2→H3 不跳级）？
- 文档是否有完整的头部元信息（标题、作者、日期等）？
- 是否存在空章节或仅有标题无内容的章节？
- 章节之间是否有合理的过渡，无内容孤岛？

#### 维度 2：逻辑一致性

检查文档内容的前后一致性：

- 前后章节的核心论点是否互相矛盾？
- 数据/数字引用是否前后一致（如前文提到 QPS 500，后文变成 5000）？
- 术语是否统一（同一概念是否使用了多个不同名称）？
- 假设与结论是否对应（基于假设 A 得出的结论，是否在假设 A 被否定后仍然成立）？
- 引用的文件路径、链接是否与实际内容对应？

#### 维度 3：语言质量

检查文字表达是否清晰、简洁、规范：

- 是否有冗余废话（"首先，我们需要……"类开场白，总结重复正文内容等）？
- 段落是否做到"每段一个中心思想"？
- 是否有歧义句（读者可能理解为多种含义）？
- 中英文混排是否符合规范（中英文/数字之间是否有空格）？
- 代码块是否标注了语言类型？
- 标点符号是否使用正确（中文文档中不混用英文标点）？

#### 维度 4：信息准确性

检查文档中的信息质量：

- 是否有未标注的假设（声称为事实但实际上是猜测的内容）？
- 是否有 `[待确认]`、`[假设]` 标注未被处理的遗留项？
- 数据、指标、日期等关键信息是否有来源支撑或明确标注为估算？
- 技术细节（接口定义、配置参数等）是否与实际系统/需求一致（如有参考资料）？
- 是否有过时内容（明显与当前版本不符的说明）？

#### 维度 5：可读性

检查文档对目标读者的友好程度：

- 文档开头是否清晰说明了目标受众、文档目的？
- 关键概念是否有适当解释（避免读者在没有背景的情况下理解困难）？
- 图表（Mermaid 等）是否有文字说明，图表是否清晰表达了意图？
- 长文档是否有目录或导航辅助？
- 章节标题是否能准确概括章节内容？
- 重要信息是否有适当强调（加粗、列表等）而不是淹没在长段落中？

### 步骤 3：汇总问题与生成报告

1. 按问题严重程度分级：
   - **P0 — 阻断**：结构缺失、关键信息矛盾、误导性内容，必须修复才能使用
   - **P1 — 重要**：逻辑漏洞、显著影响可读性的问题，强烈建议修复
   - **P2 — 建议**：语言优化、格式改进、锦上添花，酌情处理
2. 按优先级排序问题列表
3. 为每个问题提供具体的修改建议（不仅指出问题，还给出如何改）
4. 生成总体评价和后续建议

---

## 输出格式

```markdown
# 文档审阅报告

> **审阅文档**：{文档标题}
> **审阅时间**：{当前日期}
> **文档类型**：{类型名称或「通用」}
> **审阅维度**：结构完整性 / 逻辑一致性 / 语言质量 / 信息准确性 / 可读性

---

## 总体评价

{2-4 句话总结文档整体质量，指出最突出的优点和最需要改进的方面}

---

## 问题列表

### P0 — 阻断（必须修复）

| # | 位置 | 问题描述 | 修改建议 |
|---|------|---------|---------|
| 1 | {章节名/段落位置} | {具体问题描述} | {具体修改建议} |
| 2 | {位置} | {问题} | {建议} |

> 共 {N} 个 P0 问题。

### P1 — 重要（强烈建议修复）

| # | 位置 | 问题描述 | 修改建议 |
|---|------|---------|---------|
| 1 | {位置} | {问题} | {建议} |

> 共 {N} 个 P1 问题。

### P2 — 建议（酌情处理）

| # | 位置 | 问题描述 | 修改建议 |
|---|------|---------|---------|
| 1 | {位置} | {问题} | {建议} |

> 共 {N} 个 P2 问题。

---

## 各维度审阅摘要

| 审阅维度 | 状态 | 主要发现 |
|---------|:----:|---------|
| 结构完整性 | ✅ 通过 / ⚠️ 需改进 / ❌ 不通过 | {一句话说明} |
| 逻辑一致性 | ✅ / ⚠️ / ❌ | {一句话说明} |
| 语言质量 | ✅ / ⚠️ / ❌ | {一句话说明} |
| 信息准确性 | ✅ / ⚠️ / ❌ | {一句话说明} |
| 可读性 | ✅ / ⚠️ / ❌ | {一句话说明} |

---

## 建议后续操作

1. {优先级最高的行动项，如：先修复 P0 问题中的结构缺失}
2. {次要行动项，如：确认「假设清单」中的遗留待确认项}
3. {可选行动项，如：使用 `doc.format.normalize` Skill 统一格式}

---

*如需针对特定问题修改文档，可使用 `doc.iterate` Skill 进行定向优化。*
```

---

## 缺失信息处理

| 场景 | 处理方式 |
|------|---------|
| 文档未提供 | 请求用户提供文档内容或文件路径，不可继续 |
| `doc_type` 未指定 | 尝试从文档内容推断类型；无法推断则按通用规范审阅，在报告中注明 |
| 文档内容过短（< 200 字） | 审阅可进行，但在报告中注明"文档内容不足，无法充分评估" |
| 参考素材未提供 | "信息准确性"维度仅检查内部一致性，无法与外部事实对照，在报告中注明此限制 |

---

## 质量标准

审阅报告应满足：

- [ ] 覆盖全部五个审阅维度（或用户指定的 `focus_areas`）
- [ ] 每个问题均有**位置定位**（具体到章节或段落）
- [ ] 每个问题均有**具体的修改建议**（不只是指出问题）
- [ ] 问题按 P0/P1/P2 正确分级，无随意降级或升级
- [ ] 总体评价客观，不仅列问题，也认可文档的优点
- [ ] 建议后续操作具体可执行（不使用"可以考虑改进"等模糊表述）
- [ ] 若文档质量良好、无重大问题，明确给出"通过"结论，不强行挑刺

---

## 示例

**用户输入**：
> 帮我审阅这篇技术设计文档（提供 Kafka 替换 HTTP 调用的技术设计文档内容）

**Skill 行为**：
1. 读取文档，识别文档类型为 `tech-design`
2. 读取 `docs/_templates/tech-design/type.json` 获取必需章节定义
3. 执行五维度审阅：
   - 结构完整性：检查 12 个必需章节是否存在 → 发现"测试策略"章节缺失（P0）
   - 逻辑一致性：发现"背景"章节描述峰值 QPS 为 500，"风险"章节写 5000（P0）
   - 语言质量：多处段落无主题句，总结部分重复正文内容（P1）
   - 信息准确性：消费者组划分方案标注 `[假设]` 但未在假设清单中汇总（P1）
   - 可读性：架构图缺少文字说明，图例不清晰（P1）
4. 输出审阅报告：2 个 P0、3 个 P1、2 个 P2，总体评价：框架清晰但有结构缺失和数据不一致需优先修复
