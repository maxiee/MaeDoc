---
name: todo-append
description: 向 docs/TODO.md 追加一条代办事项。在任何 Command 或 Skill 执行过程中，当遇到来不及立刻完成、或更适合后续专门处理的事项时调用本 Skill。
mode: read-write
---

# todo-append

> **Skill ID**：`todo-append`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：在 Commands / Skills 执行过程中，将代办事项写入 `docs/TODO.md`，形成可追踪的全局 TODO 列表

---

## 使用指南

> 以下是 LLM 在调用本 Skill 时需要了解的关键约束和最佳实践。

**正确调用时机**（满足以下任一条件时调用）：
- 发现了需要后续处理的事项，但当前时机不适合立即处理
- 当前任务末尾的"TODO 录入"阶段（见各 Command 的最后阶段）
- 其他 Skills（`doc-content-fill`、`doc-iterate`、`doc-evaluate`、`doc-outline-generate`）在完成主体工作后的遗留项记录

**不应调用的情况**：
- 当前时机完全可以立即处理该事项时（优先直接执行）
- 仅仅是"想法"而非需要执行的事项时

**输入约束**：
- `description` 必须清晰可执行，足够让六个月后的人或 Agent 无需额外上下文即可理解
- `source` 必须说明触发来源（如"由 /create 命令在写 xxx 时发现"）
- `priority` 必须明确：`高` / `中` / `低`，不得模糊

**与其他 Skills 的协作**：
- 被多个 Skills 调用（`doc-content-fill`、`doc-iterate`、`doc-evaluate`、`doc-outline-generate`）
- 输出记录到 `docs/TODO.md`，由 `/do-todo` 命令执行

---

## 何时调用本 Skill

满足以下任一条件时，**调用方应调用本 Skill 追加 TODO**，而非静默跳过或强行处理：

| 场景 | 示例 |
|------|------|
| **时机不对**：当前任务中途发现需要做某事，但此刻处理会打断主流程 | /create 写文档时发现某个章节需要深度调研 |
| **范围越界**：发现的问题超出本次命令的预期范围 | /review 时发现某个关联文档也需要更新 |
| **依赖未就绪**：需要用户先提供信息或完成某件事，才能继续 | 缺少某个设计决策的输入，需要用户先思考 |
| **后续专项处理**：该事项适合单独一次完整执行，混入当前流程反而降低质量 | 复杂的内容重写、跨文档概念同步 |
| **低优先级改善**：不影响主任务但值得记录的改进点 | 某篇文档格式不规范，但不是当前重点 |

---

## 输入

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `description` | 是 | 该 TODO 的具体描述——**要清晰到足够让未来的执行者（Agent 或人类）理解要做什么** |
| `source` | 是 | 触发来源（如"由 /create 命令在写 xxx 时发现"） |
| `priority` | 是 | `高` / `中` / `低` |
| `background` | 否 | 补充背景：当时的任务上下文、发现问题的原因、执行时需要知道的约束 |

---

## 执行步骤

### 步骤 1：读取 docs/TODO.md

读取 `docs/TODO.md`。若文件不存在，使用以下内容初始化：

```markdown
# TODO 列表

> 本文件由 MaeDoc Agent 自动维护，记录所有代办事项。
> 在 Commands 和 Skills 执行过程中，对于来不及立刻完成或更适合专门处理的事项，会自动追加到此处。
>
> - **查看列表**：`/do-todo`（无参数）
> - **执行某项**：`/do-todo <编号>`（如 `/do-todo T-001`）

---

## 待处理

*(暂无待处理项)*

---

## 已完成

*(暂无已完成项)*

---

*最后更新：{今日日期}*
```

---

### 步骤 2：确定下一个编号

扫描文件中所有 `T-NNN` 格式的编号（包括"待处理"和"已完成"区域），取最大编号 + 1。若无任何编号，从 `T-001` 开始。

**编号格式**：`T-{三位数字}`，不足三位左补零（如 `T-001`、`T-012`、`T-100`）。

---

### 步骤 3：组装 TODO 条目

使用以下格式组装条目：

```markdown
### {编号} · {优先级}优先级

**描述**：{description}

**来源**：{source}

**创建**：{今日日期}

{如果 background 非空：}
**背景**：{background}
```

示例：

```markdown
### T-003 · 高优先级

**描述**：补充 infrastructure/ai-integration.md 中权限控制模型的细节——当前仅有概念描述，缺少具体的权限层级定义和跨服务授权流程

**来源**：由 /create 命令在生成 AI 集成文档时发现

**创建**：2026-02-21

**背景**：在写权限控制章节时，发现项目中有两种权限模型（基于角色 vs 基于能力），需要先明确使用哪种，再补充细节。相关讨论见 docs/infrastructure/ai-integration.md §3
```

---

### 步骤 4：插入到"待处理"区域

在 `docs/TODO.md` 的 `## 待处理` 区域末尾插入新条目：

- 若当前"待处理"区域只有 `*(暂无待处理项)*`，替换为新条目
- 若已有条目，在最后一个条目后追加（保留一个空行间隔）

---

### 步骤 5：更新末尾日期

将文件末尾的 `*最后更新：{日期}*` 更新为今日日期。

---

### 步骤 6：写回文件

将更新后的内容写回 `docs/TODO.md`。

---

### 步骤 7：告知调用方

输出简短提示（供调用方在自己的输出中展示）：

```
已记录 TODO {编号}：{description 前 50 字}...（优先级：{priority}）
```

若 description ≤ 50 字，直接输出完整描述，不加省略号。

---

## 注意事项

1. **描述要可执行**：TODO 的描述必须清晰到让未来执行者无需查额外上下文即可理解——想象六个月后的自己或 AI Agent 看到这条 TODO
2. **不替代立即执行**：若当前时机合适、不打断主流程，优先直接执行，而非记 TODO
3. **背景宁多勿少**：background 字段记录发现问题时的完整上下文，避免未来执行时信息断层
4. **编号永不复用**：即使某个 TODO 被删除，其编号也不再分配给新条目
5. **不修改已完成区域**：本 Skill 仅追加"待处理"条目，不操作"已完成"区域
