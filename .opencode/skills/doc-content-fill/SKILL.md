---
name: doc-content-fill
description: 根据已确认的文档大纲逐章节生成和填充内容，输出完整 Markdown 文档，为每章节标注信心等级（高/中/低），并输出填充摘要
---

# doc-content-fill

> **Skill ID**：`doc-content-fill`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：根据文档大纲逐章节生成/填充内容，输出完整的 Markdown 文档

---

## 触发条件

当用户说出以下类似意图时，激活本 Skill：

- "根据这个大纲，帮我填充内容"
- "按大纲写出完整文档"
- "把这个章节的内容写出来"
- 或由 `/create` 命令在大纲确认后内部调用

---

## 输入

本 Skill 需要以下信息（如未提供，按照"缺失信息处理"步骤主动收集）：

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `output_file` | 是* | 目标文件路径（如 `docs/my-doc.md`）；Skill 从此文件读取大纲，并将填充结果逐章节写回此文件。与 `outline` 二选一，优先使用 `output_file` |
| `outline` | 是* | 已确认的文档大纲（当未提供 `output_file` 时使用，由 `doc-outline-generate` 生成或用户自行提供） |
| `materials` | 否 | 用户提供的素材：背景资料、数据、代码片段、参考文档等 |
| `constraints` | 否 | 额外约束：目标长度、语言风格、受众、需要强调的内容 |
| `max_lines` | 否 | 单文档篇幅上限（行数），默认 `300`；填充完成后若超出则输出超限警告 |

> *`output_file` 和 `outline` 至少提供一个。若同时提供 `output_file`，则以文件内容为准。

---

## 执行步骤

> **交互原则**：所有需要向用户提问或确认的步骤，**必须使用 `question` 工具**进行交互，不得直接输出文本等待用户回复。

### 步骤 1：准备阶段

1. **读取大纲**：
   - 若提供了 `output_file`：直接**从该文件读取**大纲内容（文件当前应包含 `doc-outline-generate` 写入的大纲）
   - 若未提供 `output_file`：从 `outline` 参数读取大纲内容
2. 解析大纲，提取章节列表和每章节的"所需输入"与"验收标准"
3. 读取通用写作规范：`maedoc/writing-guidelines.md`
4. 整合用户提供的素材，建立写作上下文
5. 若提供了 `output_file`：在开始填充前，使用 **`write` 工具**将文档头部元信息 + 所有章节标题（作为占位结构）写入文件（创建或完整覆盖），确保文件在填充过程中始终是可读的部分完成状态：
   ```markdown
   # {文档标题}

   > **文档类型**：{类型名称}
   > **作者**：未指定
   > **日期**：{日期}
   > **版本**：1.0.0
   > **状态**：填充中...

   ---

   ## {章节 1 标题}

   *（填充中...）*

   ---

   ## {章节 2 标题}

   *（填充中...）*

   ---
   ```
6. 检查大纲中的"假设与待确认事项"：
   - 若有标注为"待确认"的关键项，使用 `question` 工具一次性列出所有待确认项，收集用户回答后再开始填充：
     - **标题**：确认关键假设
     - **问题**：开始填充前，以下关键信息需要确认（可跳过，跳过则使用假设值）：{待确认项列表}
     - **选项**：{每个待确认项作为一个问题，或提供"全部使用假设值继续"选项}
   - 若用户选择跳过，则按假设值填入并在对应位置标注 `[假设: ...]`
7. **读取文档库上下文**（若 `docs/index.md` 存在）：
   - 读取 `docs/index.md`，了解现有文档结构
   - 识别与当前文档主题相关的已有文档（最多 2 个），读取其关键章节或开头段落
   - 提取已有文档中的核心术语定义，在填充过程中保持一致
   - 若当前内容与已有文档有关联，通过相对路径链接引用，而非重写
   - 若 `docs/index.md` 不存在，跳过此步骤

### 步骤 2：逐章节填充

按大纲章节顺序，依次执行以下动作：

**每个章节的填充流程**：

1. 宣告当前正在填充的章节：
   ```
   正在填充：## {章节标题}
   ```

2. 结合以下信息生成内容：
   - 章节的"所需输入"和"验收标准"（来自大纲）
   - 用户提供的相关素材
   - 写作规范约束

3. 填充内容后，立即标注该章节的**信心等级**（见"信心等级标准"）

4. **写回文件（若提供了 `output_file`）**：使用 **`edit` 工具**将文件中该章节对应的 `*（填充中...）*` 占位内容精确替换为实际填充的章节内容（定向替换，不重写整个文件）。每章节填充完毕后立即执行，不等待所有章节完成。写入后输出：
   ```
   ✅ 已写入：## {章节标题} → {output_file}
   ```

5. 章节间保持内容一致性：
   - 前后引用的术语保持统一
   - 后续章节可引用前面章节已建立的结论
   - 如发现前面章节有需要修正的内容，在当前位置标注并说明

### 步骤 3：汇总与收尾

1. 所有章节填充完成后，使用 **`edit` 工具**将 `output_file` 中文档状态由 `填充中...` 更新为 `草稿`（若已提供 `output_file`）；若未提供 `output_file`，在上下文中输出完整文档
2. 输出**填充摘要**：各章节信心等级汇总、遗留的待确认项、建议的后续操作
3. **篇幅检查**（若提供了 `output_file`）：统计 `output_file` 的实际行数：
   - 若实际行数超出 `max_lines`（默认 300），输出超限警告：
     ```
     ⚠️ 篇幅警告：当前文档已达 {actual} 行，超出单文档上限 {max_lines} 行。
     建议：使用 /evolve 对此文档进行拆分，或下次创建时在大纲确认阶段选择"多文件文档树"形式。
     ```

---

## 输出格式

### 完整文档格式

```markdown
# {文档标题}

> **文档类型**：{类型名称}
> **作者**：{作者或「未指定」}
> **日期**：{日期}
> **版本**：1.0.0
> **状态**：草稿

---

## {章节 1 标题}

{章节内容}

---

## {章节 2 标题}

{章节内容}

### {子章节标题}

{子章节内容}

---

（……其余章节……）

---

## 假设与待确认事项

| # | 假设/待确认内容 | 影响范围 | 状态 |
|---|----------------|---------|------|
| 1 | {假设内容} | {章节名} | 假设 |
| 2 | {待确认内容} | {章节名} | 待确认 |
```

### 填充摘要格式

在完整文档之后，输出以下摘要块：

```markdown
---

## 📋 填充摘要

### 各章节信心等级

| 章节 | 信心等级 | 说明 |
|------|:--------:|------|
| {章节 1} | 🟢 高 | {原因简述} |
| {章节 2} | 🟡 中 | {原因简述，如：缺少实际数据，基于假设填写} |
| {章节 3} | 🔴 低 | {原因简述，如：核心方案未确认，内容为示意性占位} |

### 遗留待确认项

- [ ] {待确认项 1}：影响「{章节名}」，建议在 {时间节点} 前确认
- [ ] {待确认项 2}：影响「{章节名}」

### 建议后续操作

1. 确认上述待确认项，使用 `doc-iterate` Skill 针对性更新对应章节
2. 使用 `doc-review` Skill 对全文进行质量审阅
3. 使用 `doc-format-normalize` Skill 统一格式
```

---

## 信心等级标准

每个章节完成后，按以下标准标注信心等级：

| 等级 | 标识 | 判定条件 |
|------|:----:|---------|
| 高 | 🟢 | 用户提供了充分素材，内容基于确定信息，无关键假设 |
| 中 | 🟡 | 部分内容基于合理假设，或素材不完整但可合理推断 |
| 低 | 🔴 | 核心内容未确认，大量依赖假设，或素材严重不足 |

**信心等级规则**：

- 🔴 低信心章节必须在内容中用 `[假设: ...]` 显式标注所有假设点
- 🟡 中信心章节需标注关键假设，并在填充摘要中说明所缺素材
- 🟢 高信心章节若有任何不确定点，仍需标注，不得省略

---

## 写作约束

填充内容时，严格遵循以下约束（优先级从高到低）：

1. **用户明确指定的约束**（通过 `constraints` 参数传入）
2. **通用写作规范**（`maedoc/writing-guidelines.md`）

核心写作原则（摘自通用规范）：

- 每段落一个中心思想，首句即主题句
- 先结论后展开，不在结尾重复正文内容
- 不确定信息用 `[待确认: ...]` / `[假设: ...]` 标注，不编造数据
- 中英文混排时，中英文/数字之间加空格
- 代码块必须标注语言类型

---

## 缺失信息处理

| 场景 | 处理方式 |
|------|---------|
| `output_file` 和 `outline` 均未提供 | 使用 `question` 工具请求用户提供大纲内容或文件路径，不可继续 |
| `output_file` 指定的文件不存在或为空 | 使用 `question` 工具确认是否从 `outline` 参数读取；若也未提供，终止执行 |
| 大纲中有"待确认"关键项 | 使用 `question` 工具一次性列出并询问；用户跳过则用假设值 + 标注 |
| 章节所需素材未提供 | 基于合理推断填写，标注 `[假设: ...]`，信心等级降为中或低 |
| 专有名词/数据未知 | 用 `[待确认: 具体描述]` 占位，不编造 |
| 某章节内容与前章矛盾 | 在当前章节标注冲突，暂保留两处内容，摘要中提醒用户决策 |

**原则**：任何章节都必须输出，不得因缺少素材而跳过。内容质量不足时降低信心等级并标注原因，保证文档骨架完整。

---

## 质量标准

输出的完整文档应满足：

- [ ] 所有大纲章节均已填充，无遗漏
- [ ] 每个章节均有对应的信心等级标注（体现在填充摘要中）
- [ ] 所有假设均用 `[假设: ...]` 在正文中显式标注
- [ ] 文档头部元信息完整（标题、作者、日期、状态）
- [ ] 遵循写作规范：无废话开场白、术语统一、中英文间距正确
- [ ] 低信心章节有足够的标注，让读者知道哪些内容需要验证
- [ ] 填充摘要完整输出（信心等级表 + 遗留待确认项 + 后续建议）

---

## 示例

**输入**：
> 大纲：Kafka 替换同步 HTTP 调用技术设计文档（由 `doc-outline-generate` 生成）
> 素材：现有系统包含 3 个服务（订单服务、库存服务、通知服务），订单服务同步调用另外两个，峰值 QPS 约 500，P99 延迟目前 800ms，目标 < 200ms

**Skill 行为**：
1. 读取大纲章节列表，识别各章节所需输入
2. 读取通用写作规范 `maedoc/writing-guidelines.md`
3. 按顺序填充各章节：
   - "执行摘要"：基于素材写出问题、方案、预期收益 → 🟢 高
   - "背景与问题陈述"：描述 3 服务耦合现状和延迟问题 → 🟢 高
   - "架构设计"：画出 Kafka 接入后的新架构（Mermaid 序列图） → 🟡 中（Topic 划分方案未确认）
   - "安全与隐私考量"：消息加密、ACL 策略 → 🟡 中（具体安全策略待定）
   - "里程碑与排期"：填入 `[待确认: 研发资源和交付日期]` → 🔴 低
4. 输出完整文档 + 填充摘要
