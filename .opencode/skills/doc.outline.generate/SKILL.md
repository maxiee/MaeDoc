# doc.outline.generate

> **Skill ID**：`doc.outline.generate`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：根据用户想法描述 + 目标文档类型，生成结构化 Markdown 大纲

---

## 触发条件

当用户说出以下类似意图时，激活本 Skill：

- "帮我生成一个大纲"
- "我想写一篇 XX，先给我列个结构"
- "根据这个想法，生成大纲"
- 或由 `/create` 命令内部调用

---

## 输入

本 Skill 需要以下信息（如未提供，按照"缺失信息处理"步骤主动收集）：

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `idea` | 是 | 用户的想法描述，可以是一句话到几段话 |
| `doc_type` | 是 | 目标文档类型（如 `tech-design`、`blog-post`、`generic`） |
| `extra_constraints` | 否 | 额外约束，如目标受众、长度限制、特殊章节要求 |

---

## 执行步骤

### 步骤 1：解析输入与收集缺失信息

1. 从用户描述中提取核心意图：**主题**、**目的**、**受众**（如能识别）
2. 确认目标文档类型：
   - 如用户已明确指定（如"技术设计文档"、"博客文章"）→ 直接匹配对应类型
   - 如未明确指定 → 基于意图推断最匹配的类型，并向用户确认：
     ```
     根据你的描述，我建议使用「{类型名称}」文档类型。
     这种类型适合：{类型描述}
     是否继续，或者你希望换一个类型？
     ```
3. 读取对应文档类型的定义文件 `docs/_templates/{type_id}/type.json`，获取章节结构

### 步骤 2：识别缺失信息

根据用户输入和文档类型的 `variables` 字段，识别哪些关键信息缺失：

- **文档标题**：是否已知？
- **核心论点/方案**：是否足够清晰？
- **目标受众**：是否已明确？
- **约束条件**：是否有特殊要求？

对于缺失的关键信息，在大纲的"假设清单"中标注，**不阻塞大纲生成**。

### 步骤 3：生成定制化大纲

基于文档类型的章节定义（`sections`），结合用户提供的信息，生成大纲。

**大纲生成规则**：

1. **章节顺序**：严格按照 `type.json` 中 `sections` 的顺序排列
2. **必需章节**：`required: true` 的章节必须出现，不可省略
3. **可选章节**：`required: false` 的章节，根据用户意图判断是否包含，并标注 `（可选）`
4. **子章节**：如 `subsections` 非空，按定义展开；如为空，根据内容需要自行拆分
5. **内容提示**：每个章节标注"所需输入"和"验收标准"（见输出格式）

### 步骤 4：输出大纲

按照以下格式输出大纲，然后给出"待确认问题清单"。

---

## 输出格式

```markdown
# 文档大纲：{文档标题或「待确认」}

> **文档类型**：{类型名称}（`{type_id}`）
> **生成时间**：{当前日期}
> **状态**：草稿大纲，待用户确认

---

## 大纲结构

### 1. {章节标题} `[必需]`

**所需输入**：
- {需要用户提供的具体信息，每条一行}

**验收标准**：
- {本章节完成的判断依据，每条一行}

**内容提示**：{基于章节描述和用户想法，给出具体的写作方向建议}

---

### 2. {章节标题} `[必需]`

**所需输入**：
- {信息 1}
- {信息 2}

**验收标准**：
- {标准 1}

**内容提示**：{写作方向}

---

### 3. {章节标题} `[可选]`

> 建议包含原因：{一句话说明为何建议包含此章节}

**所需输入**：
- {信息}

**验收标准**：
- {标准}

**内容提示**：{写作方向}

---

## 假设与待确认事项

| # | 待确认/假设内容 | 影响章节 | 状态 |
|---|----------------|---------|------|
| 1 | {假设或待确认内容} | {章节名} | 待确认 |
| 2 | {假设内容} | {章节名} | 假设 |

---

## 需要用户确认的问题清单

在开始填充内容之前，以下问题需要你的输入：

**必须回答（影响核心结构）**：
1. {问题 1}？
2. {问题 2}？

**可选回答（影响内容深度，跳过则使用假设值）**：
3. {问题 3}？
4. {问题 4}？

---

*确认大纲后，可使用 `doc.content.fill` Skill 逐章节填充内容。*
```

---

## 缺失信息处理

| 场景 | 处理方式 |
|------|---------|
| 文档类型不明确 | 推断 + 向用户确认，不强制询问 |
| 标题未指定 | 使用 `[待确认: 文档标题]` 占位，继续生成 |
| 核心内容不清晰 | 生成大纲，在对应章节标注 `[待确认: 需要用户提供...]` |
| 目标受众未知 | 在假设清单中列出，填入合理默认假设 |

**原则**：缺失信息不阻塞大纲生成。优先输出可用的大纲骨架，将待确认事项汇总在文末清单。

---

## 质量标准

生成的大纲应满足：

- [ ] 所有 `required: true` 章节均已包含
- [ ] 每个章节有明确的"所需输入"和"验收标准"
- [ ] 假设清单列出了所有不确定信息
- [ ] 问题清单区分了"必须回答"和"可选回答"
- [ ] 大纲结构与 `type.json` 中的 `sections` 顺序一致
- [ ] 没有无意义的占位内容（所有提示应具体、可操作）

---

## 示例

**用户输入**：
> 我想写一篇技术设计文档，介绍我们团队计划引入 Kafka 来替换现有的同步 HTTP 调用，解决服务间耦合问题。

**Skill 行为**：
1. 识别类型：`tech-design`（技术设计文档）
2. 读取 `docs/_templates/tech-design/type.json` 获取章节定义
3. 生成包含以下章节的大纲：执行摘要、背景与问题陈述、目标与非目标、架构设计、组件清单、数据流与接口定义、安全与隐私考量、测试策略、部署与运维、风险与缓解、里程碑与排期、假设清单
4. 在"架构设计"章节标注所需输入：现有架构图、涉及服务列表、消息格式定义
5. 输出待确认问题：峰值 QPS 估算、消息持久化策略、消费者组划分方案
