---
name: doc-quality-score
description: 对文档进行量化质量评分，从结构完整性、内容深度、语言质量、一致性、可操作性五个维度评分，输出总分（0-100）+ 各维度分数 + 改进建议
---

# doc-quality-score

> **Skill ID**：`doc-quality-score`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：对文档进行量化质量评分，输出各维度分数、总分与针对性改进建议

---

## 触发条件

当用户说出以下类似意图时，激活本 Skill：

- "给这篇文档打个分"
- "评估一下这个文档的质量"
- "这篇文档质量怎么样，量化一下"
- "对这个文档做质量评分"
- "quality score 这篇文档"
- 或由 `/review`、`/audit` 命令内部调用

---

## 输入

本 Skill 需要以下信息（如未提供，按照"缺失信息处理"步骤主动收集）：

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `document` | 是 | 待评分的文档内容或文件路径 |
| `doc_type` | 否 | 文档类型（`type_id`），如 `tech-design`、`blog-post`；未指定则按通用规范评分 |
| `weights` | 否 | 自定义各维度权重（JSON 格式），未指定则使用默认权重 |

---

## 评分维度与权重

| 维度 | 默认权重 | 满分 | 说明 |
|------|:--------:|:----:|------|
| 结构完整性 | 30% | 30 | 是否覆盖必需章节、层级是否清晰 |
| 内容深度 | 25% | 25 | 每章节是否有足够细节与实质内容 |
| 语言质量 | 20% | 20 | 清晰度、简洁度、表达规范性 |
| 一致性 | 15% | 15 | 术语统一、格式统一、前后一致 |
| 可操作性 | 10% | 10 | 是否有明确的下一步或行动项 |
| **总分** | **100%** | **100** | |

> **分数解读**：
> - 90–100：优秀，可直接使用或发布
> - 75–89：良好，少量改进后可使用
> - 60–74：及格，需要针对性改进
> - 40–59：不足，需要较大幅度修改
> - 0–39：不合格，建议重写关键章节

---

## 执行步骤

### 步骤 1：准备阶段

1. 读取待评分文档，提取：
   - 所有标题（H1/H2/H3）构建章节树
   - 每章节的内容长度（字/词数）
   - 代码块、表格、图表的数量与位置
   - 文档总长度
2. 若提供 `doc_type`：
   - 读取 `docs/_templates/{type_id}/type.json`（获取必需章节定义与权重提示）
   - 读取 `docs/_templates/{type_id}/guidelines.md`（获取类型专属写作规范）
3. 读取通用写作规范：`docs/_templates/writing-guidelines.md`
4. 若提供自定义 `weights`，校验权重总和是否为 100%；若不合法，提示用户并使用默认权重

---

### 步骤 2：维度 1 — 结构完整性（满分 30 分）

**评分标准**：

| 分数段 | 标准 |
|--------|------|
| 27–30 | 所有必需章节存在且顺序正确，层级清晰（H1→H2→H3 不跳级） |
| 21–26 | 缺少 1 个必需章节，或存在轻微层级跳跃 |
| 15–20 | 缺少 2–3 个必需章节，或层级结构混乱 |
| 8–14 | 缺少超过 3 个必需章节，章节组织不清晰 |
| 0–7 | 无结构化章节，或文档完全不符合类型定义 |

**评分逻辑**：

1. 若有 `doc_type`：计算必需章节覆盖率 `= 存在必需章节数 / 总必需章节数`，以覆盖率为基础映射到分数区间
2. 若无 `doc_type`：检查文档是否有合理的层级结构（至少有 H1 和 H2），评估整体组织是否清晰
3. 额外加分项（最多 +3，不超过上限）：
   - 章节顺序与类型定义完全一致：+1
   - 存在文档头部元信息（标题、作者、日期）：+1
   - 所有章节均有实质内容（无空章节）：+1
4. 记录：缺失章节列表、层级问题列表、最终得分

---

### 步骤 3：维度 2 — 内容深度（满分 25 分）

**评分标准**：

| 分数段 | 标准 |
|--------|------|
| 22–25 | 每个主要章节均有充实内容，关键章节有具体示例/数据/图表支撑 |
| 17–21 | 大多数章节内容充实，但 1–2 个关键章节内容单薄 |
| 11–16 | 约一半章节内容充实，另一半过于简短或停留于概述 |
| 5–10 | 大多数章节内容单薄，缺乏细节与具体说明 |
| 0–4 | 文档内容极度匮乏，基本只有标题和一两句话 |

**评分逻辑**：

1. 统计每个 H2 章节的内容字数（不含子章节标题本身）：
   - 核心章节（`required: true` 或按惯例关键）期望 ≥ 150 字
   - 辅助章节期望 ≥ 50 字
   - 空章节（< 20 字）计为"空章节"
2. 计算"内容充实章节占比" = 达标章节数 / 总章节数
3. 检查是否存在具体化支撑：
   - 代码示例：每个代码块 +0.5 分（最多 +3）
   - 数据/指标引用：发现数字与度量单位 +0.5 分/处（最多 +2）
   - 图表（Mermaid、表格）：每个 +0.5 分（最多 +2）
4. 基础分（由章节充实占比决定）+ 具体化加分，不超过 25 分上限
5. 记录：空章节列表、内容单薄章节列表、最终得分

---

### 步骤 4：维度 3 — 语言质量（满分 20 分）

**评分标准**：

| 分数段 | 标准 |
|--------|------|
| 18–20 | 表达清晰简洁，无冗余废话，中英文混排规范，无歧义句 |
| 14–17 | 偶有冗余或格式问题，整体可读，不影响理解 |
| 9–13 | 多处冗余、歧义或格式不规范，需要显著改写 |
| 4–8 | 语言质量明显不足，影响阅读体验 |
| 0–3 | 语言质量极差，难以理解 |

**评分逻辑**：

从 20 分开始，每发现以下问题扣分（总扣分不超过 20 分，最低 0 分）：

| 问题类型 | 扣分 |
|---------|------|
| 每个冗余开场白（"首先，我们需要……"等） | -1 |
| 每处歧义句（可以被理解为多种含义） | -1.5 |
| 中英文/数字之间缺少空格（每处） | -0.5（最多 -3） |
| 代码块缺少语言标注（每个） | -0.5（最多 -2） |
| 段落超过 200 字且无换行/列表 | -1（每处） |
| 中文文档中混用英文标点（每处） | -0.5（最多 -2） |
| 标题使用不当（如 H1 出现多次） | -2 |

记录：具体问题位置与类型、最终得分

---

### 步骤 5：维度 4 — 一致性（满分 15 分）

**评分标准**：

| 分数段 | 标准 |
|--------|------|
| 13–15 | 术语全文统一，格式完全一致，数据前后吻合 |
| 10–12 | 个别术语不统一或格式小差异，不影响理解 |
| 6–9 | 多处术语不统一或格式不一致，需要统一处理 |
| 2–5 | 术语混乱或格式差异显著，严重影响可读性 |
| 0–1 | 一致性极差，同一概念有多种表达且相互矛盾 |

**评分逻辑**：

从 15 分开始，扣分：

| 问题类型 | 扣分 |
|---------|------|
| 同一概念使用不同术语（每组同义词） | -2（最多 -6） |
| 数据/数字前后矛盾（每处） | -3（最多 -6） |
| 列表格式不统一（有序/无序混用无规律） | -1（最多 -2） |
| 标题大小写/标点风格不统一 | -1（最多 -2） |
| 引用格式不统一 | -0.5（最多 -1） |

记录：术语不一致对、数据矛盾位置、最终得分

---

### 步骤 6：维度 5 — 可操作性（满分 10 分）

**评分标准**：

| 分数段 | 标准 |
|--------|------|
| 9–10 | 文档有明确的下一步行动、截止时间或责任人，读者知道如何推进 |
| 7–8 | 有下一步说明，但部分行动项不够具体（缺责任人或时间） |
| 4–6 | 有模糊的下一步提示，但缺乏可执行的具体指引 |
| 1–3 | 文档以描述性内容结尾，未提供任何行动指引 |
| 0 | 完全无下一步、无行动项、无后续说明 |

**评分逻辑**：

1. 检查文档是否存在以下元素：
   - 明确的"下一步"/"Next Steps"/"待办事项"/"Action Items" 章节或列表：+4
   - 行动项有责任人（@某人 或 "负责人：XXX"）：+2
   - 行动项有时间节点（日期、里程碑）：+2
   - 文档有明确的"适用范围"/"目标受众"说明（读者知道自己是否需要行动）：+1
   - 文档末尾有总结段落引导读者下一步：+1
2. 累计加分（最多 10 分）
3. 记录：可操作性元素发现列表、最终得分

---

### 步骤 7：计算总分与生成报告

1. 各维度得分加权求和（默认权重或用户自定义权重）得到总分（0–100）
2. 按总分确定质量等级（优秀/良好/及格/不足/不合格）
3. 按得分差距（满分 - 实际得分）从大到小，为失分最多的维度优先给出改进建议
4. 对每个维度，从记录的问题列表中提取 Top 3 改进建议（按影响分数从高到低）
5. 生成完整评分报告

---

## 输出格式

```markdown
# 文档质量评分报告

> **评分文档**：{文档标题或文件路径}
> **评分时间**：{当前日期}
> **文档类型**：{类型名称或「通用」}

---

## 总分

```
┌─────────────────────────────────────────┐
│                                         │
│   总分：{N} / 100   [{等级}]            │
│                                         │
│   结构完整性  {n1:>2}/30  {进度条}       │
│   内容深度    {n2:>2}/25  {进度条}       │
│   语言质量    {n3:>2}/20  {进度条}       │
│   一致性      {n4:>2}/15  {进度条}       │
│   可操作性    {n5:>2}/10  {进度条}       │
│                                         │
└─────────────────────────────────────────┘
```

> **等级说明**：优秀（90–100）/ 良好（75–89）/ 及格（60–74）/ 不足（40–59）/ 不合格（0–39）

---

## 各维度详情

### 结构完整性 — {n1}/30

**评分依据**：{简短说明，1-2 句话}

{若有 doc_type：}
| 必需章节 | 状态 |
|---------|:----:|
| {章节名} | ✅ 存在 |
| {章节名} | ❌ 缺失 |

**主要问题**：
- {问题 1}
- {问题 2}（无问题时写"无"）

**改进建议**：
1. {具体可执行的建议}
2. {具体可执行的建议}

---

### 内容深度 — {n2}/25

**评分依据**：{简短说明}

| 章节 | 字数 | 状态 |
|------|:----:|:----:|
| {章节名} | {N} 字 | ✅ 充实 / ⚠️ 单薄 / ❌ 空章节 |

**主要问题**：
- {问题列表}

**改进建议**：
1. {建议}

---

### 语言质量 — {n3}/20

**评分依据**：{简短说明}

**扣分明细**：
| 问题类型 | 发现数量 | 扣分 |
|---------|:--------:|:----:|
| {问题类型} | {N} 处 | -{N} |
| 合计扣分 | — | -{N} |

**主要问题**（列举典型，不超过 3 条）：
- 第 {行}/「{章节}」：{具体问题描述}

**改进建议**：
1. {建议}

---

### 一致性 — {n4}/15

**评分依据**：{简短说明}

**发现的不一致**：
- **术语不一致**：「{术语 A}」与「{术语 B}」混用（出现于 {位置}）
- **数据矛盾**：{章节 A} 写 {数值 X}，{章节 B} 写 {数值 Y}
- （无问题时写"未发现一致性问题"）

**改进建议**：
1. {建议}

---

### 可操作性 — {n5}/10

**评分依据**：{简短说明}

**可操作性元素检查**：
| 元素 | 状态 |
|------|:----:|
| 下一步/行动项章节 | ✅ 存在 / ❌ 缺失 |
| 行动项有责任人 | ✅ / ❌ |
| 行动项有时间节点 | ✅ / ❌ |
| 目标受众说明 | ✅ / ❌ |
| 结尾总结与引导 | ✅ / ❌ |

**改进建议**：
1. {建议}

---

## 优先改进建议

按提分效果从高到低排列：

| 优先级 | 改进项 | 预计提分 | 所属维度 |
|:------:|--------|:--------:|---------|
| 1 | {最高价值改进建议} | +{N} 分 | {维度} |
| 2 | {次高价值改进建议} | +{N} 分 | {维度} |
| 3 | {第三改进建议} | +{N} 分 | {维度} |

---

## 后续操作建议

{根据总分给出建议：}

{若总分 ≥ 90：}
> ✅ 文档质量优秀，可直接使用。如需进一步完善，可重点关注上述改进建议。

{若总分 75–89：}
> 👍 文档质量良好，建议修复上述优先级 1–2 的改进项后再发布。
> 可使用 `doc-iterate` Skill 对指定章节进行针对性优化。

{若总分 60–74：}
> ⚠️ 文档需要改进，建议按优先改进建议逐项处理后重新评分。
> 可使用 `doc-content-fill` Skill 补充内容单薄的章节。

{若总分 < 60：}
> ❌ 文档质量不足，建议：
> 1. 使用 `doc-structure-audit` Skill 先修复结构问题
> 2. 使用 `doc-content-fill` Skill 补充各章节内容
> 3. 修改完成后重新运行 `doc-quality-score` 评估进度

---

*进度条图例：▓ = 已得分；░ = 未得分（每格代表约 5% 比例）*
```

---

## 进度条生成规则

进度条长度固定 10 格，每格代表该维度满分的 10%：

- 得分率 ≥ 该格阈值：显示 `▓`
- 得分率 < 该格阈值：显示 `░`

示例：25/30 → 得分率 83% → `▓▓▓▓▓▓▓▓░░`

---

## 缺失信息处理

| 场景 | 处理方式 |
|------|---------|
| 文档未提供 | 请求用户提供文档内容或文件路径，不可继续 |
| `doc_type` 未指定 | 尝试从文档内容推断；无法推断则按通用规范评分，在报告中注明"已按通用规范评分，如需更精确的结构评分请指定 `doc_type`" |
| `weights` 总和不等于 100% | 提示"自定义权重总和为 {N}%，不等于 100%，已回退为默认权重"，使用默认权重继续 |
| 文档内容过短（< 100 字） | 评分可进行，但在报告头部注明"文档内容不足，内容深度维度评分仅供参考" |
| 文档不是 Markdown 格式 | 提示"本 Skill 针对 Markdown 文档优化，非 Markdown 内容的格式类检查可能不准确"，继续评分但豁免格式类扣分项 |

---

## 注意事项

1. **只评分，不修改**：本 Skill 不直接修改文档内容；改进建议仅供参考，需由用户或其他 Skill 执行
2. **评分客观性**：每个扣分项均需有具体证据（位置、内容），不允许主观判断扣分
3. **长度 ≠ 质量**：字数多不自动得分，内容深度评分基于"是否有实质内容"而非纯字数
4. **类型权重优先**：若 `type.json` 中对某些章节有特别标注（如 `weight_hint`），可适当调整该章节在内容深度维度的期望字数标准
5. **重复评分**：支持同一文档在修改后多次评分，建议在报告末尾附注评分版本号以便对比
6. **信心标注**：若文档中存在 `[假设]`、`[待确认]`、`[TBD]` 标注，在内容深度维度中记录为"待确认内容"，不计入正式内容字数

---

## 质量标准

评分报告应满足：

- [ ] 五个维度均有具体得分和评分依据说明
- [ ] 每个扣分项均有精确的位置定位（章节名或行号）
- [ ] 优先改进建议按预计提分效果排序，且总和合理
- [ ] 总分与各维度分数加权后一致（数学正确）
- [ ] 对文档的优点也有认可，不仅罗列问题
- [ ] 后续操作建议与总分等级相匹配

---

## 示例

**用户输入**：
> 给这篇技术设计文档打个分（提供一篇缺少"测试策略"章节、有术语不统一问题的技术设计文档）

**Skill 行为**：
1. 读取文档，识别章节树，统计各章节字数
2. 加载 `docs/_templates/tech-design/type.json`，获取 12 个章节定义
3. 结构完整性评分：11/12 必需章节存在 → 基础 27 分，但顺序有轻微偏差 → **25/30**
4. 内容深度评分：9/11 章节内容充实，有 3 个 Mermaid 图 → **20/25**
5. 语言质量评分：发现 2 处冗余开场白（-2）、3 处中英文未加空格（-1.5）→ **16.5/20**，取整 **17/20**
6. 一致性评分："消息队列"与"MQ"混用（-2）、QPS 数据前后矛盾（-3）→ **10/15**
7. 可操作性评分：有下一步章节（+4）、有时间节点（+2）、无责任人（+0）→ **7/10**
8. 总分：25+20+17+10+7 = **79/100**（良好）
9. 优先改进建议：① 统一 QPS 数据（+3）② 添加测试策略章节（+2）③ 统一术语（+2）
10. 输出完整评分报告，建议修复优先级 1–2 的问题后再发布
