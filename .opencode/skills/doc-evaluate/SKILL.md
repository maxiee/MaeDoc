---
name: doc-evaluate
description: 统一文档质量评估——对文档执行 7 维度量化评分（0-100）+ P0/P1/P2 问题清单 + 结构合规检查，单次读取完成全部评估，输出综合质量报告
mode: read-only
calls:
  - todo-append
---

# doc-evaluate

> **Skill ID**：`doc-evaluate`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：对文档进行一站式质量评估，输出量化评分（7 维度 0-100）、P0/P1/P2 问题清单与改进建议

---

## 使用指南

**正确调用时机**（满足以下任一条件时调用）：
- 需要对文档进行质量评估时（质量门检查、用户要求评分或审阅）
- 由 `doc-analyst` SubAgent 在质量分析流程中调用
- 作为 `/create`、`/iterate`、`/review` 质量门阶段的一部分

**不应调用的情况**：
- 需要修改文档内容时（应改为调用 `doc-iterate`）

**输入约束**：
- `document` 必须是已存在的文件路径或文档内容
- `audit_scope` 为 `docs_dir` 时可不提供 `document`

**与其他 Skills 的协作**：
- 通常在 `doc-content-fill` 或 `doc-iterate` 完成之后调用
- 输出的 TOP_ISSUES 可直接作为 `doc-iterate` 的 `feedback` 参数
- 若发现 P0/P1 问题，会自动调用 `todo-append` 记录到 `docs/TODO.md`

---

## 输入

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `document` | 是* | 待评估的文档内容或文件路径；若 `audit_scope = docs_dir` 则不需要 |
| `focus_areas` | 否 | 重点评估维度（如"只检查逻辑一致性"），未指定则全维度评估 |
| `audit_scope` | 否 | 审计范围：`single_doc`（默认）/ `docs_dir`（审计整个 docs/ 目录结构） |

---

## 评分维度与权重

| # | 维度 | 权重 | 满分 | 说明 |
|---|------|:----:|:----:|------|
| D1 | 结构完整性 | 20% | 20 | 层级清晰、章节完整、无跳级 |
| D2 | 内容深度 | 25% | 25 | 每章节有实质内容、有具体化支撑 |
| D3 | 语言质量 | 15% | 15 | 清晰简洁、无冗余、格式规范 |
| D4 | 逻辑一致性 | 15% | 15 | 术语统一、数据前后吻合、论点不矛盾 |
| D5 | 可操作性 | 10% | 10 | 有明确行动项、下一步指引 |
| D6 | 结构合规 | 10% | 10 | 符合 `maedoc/docs-structure-standard.md` 标准 |
| D7 | 信息准确性 | 5% | 5 | 无未标注假设、无过时信息 |
| | **总分** | **100%** | **100** | |

> **分数解读**：
> - 90-100：优秀，可直接使用或发布
> - 75-89：良好，少量改进后可使用
> - 60-74：及格，需要针对性改进
> - 40-59：不足，需要较大幅度修改
> - 0-39：不合格，建议重写关键章节

---

## 执行步骤

### 步骤 0：确定评估范围

根据 `audit_scope` 参数路由：
- `audit_scope = docs_dir`：执行**步骤 0.5（docs/ 目录结构审计）**，跳过步骤 1-4
- `audit_scope = single_doc`（默认）：跳过步骤 0.5，直接执行步骤 1-4

---

### 步骤 0.5：docs/ 目录结构审计（`audit_scope = docs_dir` 时执行）

> **标准依据**：`maedoc/docs-structure-standard.md`

扫描 `docs/` 目录下所有 `.md` 文件，检查以下违规项：

**检查项 A：行数限制**
1. 行数 > 330（超过 300 行 +10% 弹性上限）→ **错误**
2. 行数 280-330 → **警告**

**检查项 B：index.md 存在性与导航规范**
1. `docs/index.md` 是否存在
2. 每个子目录是否有 `index.md`
3. `docs/index.md` 中是否有"文档地图"章节
4. `docs/index.md` 行数是否超过 150 行

**检查项 C：未注册文档**
1. 扫描 `docs/` 下所有 `.md` 文件（排除 `_archive/`、`TODO.md`）
2. 检查每个文件是否被 `docs/index.md` 引用
3. 未被引用 → **警告**：孤立文档

生成 docs 目录结构审计报告后结束。

---

### 步骤 1：准备阶段

1. 读取待评估文档全文，提取：
   - 所有标题（H1/H2/H3）构建章节树
   - 每章节的内容长度
   - 代码块、表格、图表的数量与位置
2. 读取通用写作规范：`maedoc/writing-guidelines.md`
3. 确认评估维度：按 `focus_areas` 参数或默认执行全维度评估

---

### 步骤 2：七维度评分

#### D1：结构完整性（满分 20 分）

| 分数段 | 标准 |
|--------|------|
| 18-20 | 层级清晰（H1→H2→H3 不跳级），所有章节有实质内容 |
| 14-17 | 缺少 1 个必需章节，或存在轻微层级问题 |
| 9-13 | 缺少 2-3 个必需章节，或层级混乱 |
| 0-8 | 无结构化章节或严重不合规 |

评分逻辑：检查标题层级、空章节、头部元信息、章节过渡。

#### D2：内容深度（满分 25 分）

| 分数段 | 标准 |
|--------|------|
| 22-25 | 每个主要章节均有充实内容，有具体示例/数据/图表 |
| 17-21 | 大多数章节充实，1-2 个关键章节单薄 |
| 11-16 | 约一半章节充实 |
| 0-10 | 大多数章节单薄或内容极度匮乏 |

评分逻辑：统计各章节字数，检查具体化支撑（代码示例、数据引用、图表）。

#### D3：语言质量（满分 15 分）

从 15 分开始扣分：

| 问题类型 | 扣分 |
|---------|------|
| 冗余开场白（每处） | -1 |
| 歧义句（每处） | -1 |
| 中英文/数字缺少空格 | -0.5（最多 -2） |
| 代码块缺少语言标注 | -0.5（最多 -1.5） |
| 超长段落（>200 字无换行） | -0.5（每处） |
| 标题使用不当（H1 多次等） | -1.5 |

#### D4：逻辑一致性（满分 15 分）

从 15 分开始扣分：

| 问题类型 | 扣分 |
|---------|------|
| 同一概念使用不同术语（每组） | -2（最多 -6） |
| 数据/数字前后矛盾（每处） | -3（最多 -6） |
| 前后论点矛盾（每处） | -2 |
| 引用路径/链接与实际不对应 | -1（最多 -3） |

#### D5：可操作性（满分 10 分）

| 元素 | 加分 |
|------|------|
| 明确的"下一步"/行动项章节 | +4 |
| 行动项有责任人 | +2 |
| 行动项有时间节点 | +2 |
| 目标受众说明 | +1 |
| 结尾总结与引导 | +1 |

#### D6：结构合规（满分 10 分）

> **标准依据**：`maedoc/docs-structure-standard.md`

| 检查项 | 扣分 |
|--------|------|
| 文档超过 330 行 | -4 |
| 文档 280-330 行 | -2 |
| 内部锚点链接断裂（每处） | -1（最多 -3） |
| 文件引用断裂（每处） | -1.5（最多 -3） |
| 存在重复章节标题 | -1（最多 -2） |
| 存在重复段落（>80% 相似） | -1（最多 -2） |

从 10 分开始扣分，最低 0 分。

#### D7：信息准确性（满分 5 分）

| 分数段 | 标准 |
|--------|------|
| 5 | 无未标注假设，无 `[待确认]` 遗留，信息有来源 |
| 3-4 | 少量 `[待确认]` 标注，关键信息准确 |
| 1-2 | 多处未标注假设或 `[待确认]` 遗留 |
| 0 | 信息混乱，大量未验证内容 |

---

### 步骤 3：生成问题清单

按问题严重程度分级：
- **P0 — 阻断**：结构缺失、关键信息矛盾、误导性内容，必须修复
- **P1 — 重要**：逻辑漏洞、显著影响可读性的问题，强烈建议修复
- **P2 — 建议**：语言优化、格式改进，酌情处理

为每个问题提供：位置定位、具体描述、修改建议、预计提分。

---

### 步骤 4：生成综合报告

1. 各维度得分求和得到总分（0-100）
2. 按总分确定质量等级
3. 按得分差距为失分最多的维度优先给出改进建议
4. 输出完整评估报告

---

## 输出格式

```markdown
# 文档质量评估报告

> **评估文档**：{文档标题或文件路径}
> **评估时间**：{当前日期}

---

## 总分

总分：{N} / 100 [{等级}]

| 维度 | 得分 | 满分 | 进度 |
|------|:----:|:----:|------|
| D1 结构完整性 | {n1} | 20 | {进度条} |
| D2 内容深度 | {n2} | 25 | {进度条} |
| D3 语言质量 | {n3} | 15 | {进度条} |
| D4 逻辑一致性 | {n4} | 15 | {进度条} |
| D5 可操作性 | {n5} | 10 | {进度条} |
| D6 结构合规 | {n6} | 10 | {进度条} |
| D7 信息准确性 | {n7} | 5 | {进度条} |

---

## 问题清单

### P0 — 阻断（必须修复）

| # | 位置 | 维度 | 问题描述 | 修改建议 | 预计提分 |
|---|------|------|---------|---------|:--------:|
| 1 | {位置} | {D?} | {问题} | {建议} | +{N} |

> 共 {N} 个 P0 问题。

### P1 — 重要（强烈建议修复）

| # | 位置 | 维度 | 问题描述 | 修改建议 | 预计提分 |
|---|------|------|---------|---------|:--------:|
| 1 | {位置} | {D?} | {问题} | {建议} | +{N} |

> 共 {N} 个 P1 问题。

### P2 — 建议（酌情处理）

| # | 位置 | 维度 | 问题描述 | 修改建议 | 预计提分 |
|---|------|------|---------|---------|:--------:|
| 1 | {位置} | {D?} | {问题} | {建议} | +{N} |

> 共 {N} 个 P2 问题。

---

## 优先改进建议

| 优先级 | 改进项 | 预计提分 | 所属维度 |
|:------:|--------|:--------:|---------|
| 1 | {最高价值改进} | +{N} | {维度} |
| 2 | {次高价值改进} | +{N} | {维度} |
| 3 | {第三改进} | +{N} | {维度} |

---

## 后续操作建议

{根据总分给出对应建议}
```

---

## 将问题记录为 TODO

评估报告生成后，若存在 P0 或 P1 问题，**必须**调用 `todo-append` Skill 将其记录到 `docs/TODO.md`：

- **P0 问题**：每个单独记录一条 TODO，`priority = 高`
- **P1 问题**：可合并为一条 TODO，`priority = 中`
- **P2 问题**：可选择性记录，`priority = 低`
- `source`：`由 doc-evaluate Skill 在评估 {文档路径} 时发现`

**若仅有 P2 问题或无任何问题，此步骤可跳过。**

---

## 缺失信息处理

> **交互原则**：所有需要向用户提问的情况，**必须使用 `question` 工具**进行交互。

| 场景 | 处理方式 |
|------|---------|
| 文档未提供 | 使用 `question` 工具请求用户提供文档内容或文件路径 |
| 文档内容过短（< 200 字） | 评估可进行，但注明"文档内容不足，部分维度评分仅供参考" |
| 文档不是 Markdown 格式 | 提示格式限制，豁免格式类扣分项 |

---

## 质量标准

评估报告应满足：

- [ ] 七个维度均有具体得分和评分依据
- [ ] 每个扣分项均有精确的位置定位
- [ ] 问题按 P0/P1/P2 正确分级
- [ ] 总分与各维度分数之和一致
- [ ] 优先改进建议按预计提分排序
- [ ] 对文档优点也有认可，不仅罗列问题
- [ ] 若文档质量良好，明确给出"通过"结论

---

## 注意事项

1. **只评估，不修改**：本 Skill 不直接修改文档内容
2. **评分客观性**：每个扣分项需有具体证据（位置、内容）
3. **长度 != 质量**：字数多不自动得分
4. **单次完成**：7 维度评分 + 问题清单在一次文档读取中完成，不需多次加载
5. **信心标注**：若文档中存在 `[假设]`、`[待确认]`、`[TBD]` 标注，在 D7 维度中记录
