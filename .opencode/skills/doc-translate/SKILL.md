---
name: doc-translate
description: 将文档翻译为指定目标语言，保持文档结构不变，保留代码块和专业术语，输出完整的翻译后文档
---

# doc-translate

> **Skill ID**：`doc-translate`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：将源文档翻译为目标语言，保持 Markdown 结构、代码块和专业术语原样不变，输出完整翻译文档

---

## 触发条件

当用户说出以下类似意图时，激活本 Skill：

- "把这篇文档翻译成英文"
- "translate this document to Japanese"
- "帮我翻译一下，目标语言是法语"
- "把 README 翻成中文"
- "translate skill"
- "doc.translate"
- 或由 `/create` 等命令在多语言输出场景中内部调用

---

## 输入

本 Skill 需要以下信息（如未提供，按照"缺失信息处理"步骤主动收集）：

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `document` | 是 | 待翻译的文档内容或文件路径 |
| `target_language` | 是 | 目标语言，支持自然语言描述（如"英文"、"English"、"日本語"）或语言代码（如 `en`、`ja`、`fr`、`de`、`zh-CN`、`zh-TW`） |
| `source_language` | 否 | 源语言；未指定则自动检测 |
| `preserve_terms` | 否 | 需要保留原文不翻译的专业术语列表（如 `["MaeDoc", "Skill", "PR"]`）；默认保留代码块内所有内容及常见技术术语 |
| `style` | 否 | 翻译风格：`formal`（正式/技术文档）/ `casual`（随性/博客）/ `auto`（根据文档类型自动判断）；默认 `auto` |
| `output_path` | 否 | 输出文件路径；若提供，翻译结果同时写入该路径 |

---

## 执行步骤

### 步骤 1：准备与分析

1. 读取文档，提取以下元素并分类处理：

   | 元素类型 | 处理策略 |
   |---------|---------|
   | Markdown 标题（`#`/`##`/`###`…） | 翻译文本内容，保留 `#` 层级符号 |
   | 段落正文 | 翻译 |
   | 围栏代码块（` ``` `…` ``` `）| **保留原文，不翻译** |
   | 行内代码（`` `code` ``） | **保留原文，不翻译** |
   | Mermaid 图表 | 翻译图表中的标签文本，保留 Mermaid 语法关键字 |
   | 表格 | 翻译单元格内容，保留 `|`/`---` 表格语法 |
   | 有序/无序列表 | 翻译列表项内容，保留缩进层级和 `-`/`*`/`1.` 前缀 |
   | 链接文本（`[text](url)`） | 翻译 `text` 部分，URL 不变 |
   | 链接 URL | **保留原文，不翻译** |
   | 图片 Alt 文本（`![alt](url)`） | 翻译 alt 文本，URL 不变 |
   | YAML Frontmatter（`---`…`---`） | 翻译 value 部分，key 不变；`date`/`version` 等格式字段不翻译 |
   | HTML 注释（`<!-- -->`） | 保留原文，不翻译 |
   | 引用块（`> `） | 翻译引用内容，保留 `> ` 前缀 |
   | 角标注释（`[^1]`/`[^note]`） | 翻译注释内容，保留角标标识符 |
   | 徽章/Badge（`![badge](url)`） | 保留原文，不翻译 |

2. 识别源语言（若 `source_language` 未指定，通过正文采样自动检测）。

3. 解析 `preserve_terms`，构建术语保留列表：
   - 默认保留：产品名（如 MaeDoc）、Skill 名称（如 `doc-translate`）、常见技术缩写（PR、API、SDK、CI/CD、YAML、JSON、HTTP、URL）
   - 用户追加的术语直接加入保留列表
   - 术语保留时大小写与原文一致

4. 根据 `style` 参数（或文档类型推断）确定翻译语气：
   - `formal`：使用技术文档惯用表达，被动句/名词化结构为主
   - `casual`：口语化，贴近博客/教程风格
   - `auto`：识别到代码注释/表格/Mermaid 等技术元素时倾向 `formal`，以叙述性段落为主时倾向 `casual`

---

### 步骤 2：逐段翻译

按文档章节逐段执行翻译，遵循以下规范：

**翻译质量要求**：
- 语义忠实：翻译结果与原文含义一致，不遗漏信息，不添加原文没有的内容
- 自然流畅：符合目标语言的表达习惯，避免机器翻译腔（如逐字直译导致的句式生硬）
- 术语一致：同一术语在全文中翻译一致；若有多种常用译法，在文档首次出现时注明（如"微服务（Microservice）"）
- 格式保真：原文的 Markdown 格式符号（`**`、`_`、`` ` ``、`#` 等）在翻译后的对应位置保留

**代码块保护**：
- 围栏代码块（` ```lang … ``` `）整体保留，语言标注（如 `python`、`bash`）不翻译
- 行内代码（`` `code` ``）保留原文
- 若代码块内有注释（`# comment` / `// comment`），注释部分可以翻译（对用户更友好），但变量名、函数名、关键字不翻译

**专业术语处理**：
1. 检查每个术语是否在 `preserve_terms` 列表中：在列表中 → 原样保留
2. 不在列表中的行业术语（如"架构"、"微服务"）：翻译为目标语言的通用表达
3. 目标语言无对应表达的术语：保留原文并用括号补充说明（如 `Eventual Consistency（最终一致性）`）

**Mermaid 图表翻译规范**：
- 保留 Mermaid 指令（`graph TD`、`sequenceDiagram`、`classDiagram` 等）
- 翻译节点标签（如 `A[用户请求]` 中的"用户请求"）
- 保留节点 ID、箭头语法、样式声明

---

### 步骤 3：一致性校验

完成全文翻译后，执行以下校验：

1. **术语一致性**：扫描全文，确认同一原文术语对应的翻译统一
2. **格式完整性**：检查 Markdown 语法符号是否完整（无遗漏的 ` ``` `、`|`、`**` 等）
3. **结构对称性**：验证翻译后文档的章节数量、标题层级与原文一致
4. **链接完整性**：确认所有链接的 URL 未被修改
5. **代码块完整性**：确认代码块数量与原文一致，无内容被意外修改

---

### 步骤 4：生成翻译报告与输出

1. 输出完整的翻译后文档
2. 生成翻译摘要（元信息 + 处理统计 + 待确认项）
3. 若指定了 `output_path`，使用 **`write` 工具**将翻译文档写入对应路径

---

## 输出格式

```markdown
# 翻译完成

> **源文档**：{文档标题或文件路径}
> **源语言**：{检测到的或用户指定的源语言}
> **目标语言**：{目标语言}
> **翻译风格**：{formal / casual}
> **翻译时间**：{当前日期}

---

## 翻译统计

| 项目 | 数量 |
|------|------|
| 翻译章节数 | {N} |
| 保留代码块数 | {N}（未翻译） |
| 保留术语数 | {N} 个（{术语列表，逗号分隔}） |
| Mermaid 图表数 | {N}（标签已翻译，语法保留） |

---

## 待确认项

{如有翻译不确定的术语或表达，列出如下；无则写"无待确认项"：}

| 原文 | 翻译选择 | 说明 |
|------|---------|------|
| {原文术语} | {当前选择的译法} | {说明为何不确定，如：该术语存在多种常用译法} |

---

## 翻译后文档

{输出完整的翻译后文档内容，与原文结构完全对应}
```

---

## 缺失信息处理

> **交互原则**：所有需要向用户提问的情况，**必须使用 `question` 工具**进行交互，不得直接输出文本等待用户回复。

| 场景 | 处理方式 |
|------|---------|
| 文档未提供 | 使用 `question` 工具请求用户提供文档内容或文件路径，不可继续 |
| `target_language` 未提供 | 使用 `question` 工具询问用户目标语言，不可继续 |
| 源语言识别失败（混合语言等） | 使用 `question` 工具提示用户指定 `source_language`，或请用户确认识别结果后继续 |
| 术语存在多种主流译法 | 选择最常见译法，在"待确认项"中列出，并给出备选方案 |
| 源文档包含方言或俚语 | 翻译为目标语言的通俗表达，并在"待确认项"中注明原文 |
| 文档含大量专有名词（如人名、地名） | 保留原文，或在首次出现时提供音译+原文（如"约翰（John）"），在"待确认项"中列出 |

---

## 注意事项

1. **结构保真优先**：任何情况下都不得改变文档的章节结构、标题层级和 Markdown 格式
2. **代码不可翻译**：围栏代码块和行内代码内容严禁翻译（代码注释除外，且翻译注释为可选行为）
3. **不添加内容**：翻译不得添加原文中没有的内容，即使翻译者认为这样更清晰
4. **保留 `[假设]`/`[待确认]`/`[TBD]` 标注**：这些标注应翻译为目标语言的等价表达（如英文中翻译为 `[Assumption]`/`[To Be Confirmed]`/`[TBD]`）
5. **术语表优先**：若用户提供了术语表（`preserve_terms`），严格遵守，不得自行"纠正"
6. **链接 URL 不变**：不得修改任何超链接的 URL，无论目标语言是否有对应的本地化链接
7. **完整输出**：必须输出完整的翻译后文档，不得仅输出变更部分或摘要

---

## 质量标准

翻译输出应满足：

- [ ] 翻译后文档的章节数量与标题层级与原文完全一致
- [ ] 所有围栏代码块和行内代码均保留原文，未被翻译
- [ ] `preserve_terms` 列表中的术语原样保留，大小写一致
- [ ] 所有 Markdown 格式符号完整，无遗漏
- [ ] 所有超链接 URL 未被修改
- [ ] 翻译文本自然流畅，无明显机器翻译腔
- [ ] 同一术语在全文中翻译一致
- [ ] 不确定的翻译选择已在"待确认项"中列出

---

## 示例

**用户输入**：
> 把这篇 README 翻译成英文，保留 "MaeDoc"、"Skill" 这两个词不翻译。

**Skill 行为**：
1. 读取 README，自动检测源语言为"中文"
2. 目标语言：`en`（English）；`preserve_terms = ["MaeDoc", "Skill"]`
3. 翻译风格：`auto` → 检测到技术文档风格 → `formal`
4. 逐段翻译：
   - 标题 `# MaeDoc —— 通用文档 AI Agent 生成器` → `# MaeDoc —— Universal Document AI Agent Generator`
   - 保留代码块内容不变
   - "Skill" 原样保留（在 preserve_terms 中）
   - Mermaid 图表中的节点标签翻译为英文，图表语法保留
5. 校验：章节数量一致、代码块完整、URL 未变更
6. 输出翻译报告 + 完整英文 README
