---
name: doc-outline-generate
description: 根据用户想法描述和目标文档类型，生成结构化 Markdown 大纲，自动评估文档规模（单文件 vs 多文件文档树），标注所需输入、验收标准与待确认问题清单，缺失信息不阻塞生成
---

# doc-outline-generate

> **Skill ID**：`doc-outline-generate`
> **版本**：1.0.0
> **类型**：instruction
> **用途**：根据用户想法描述 + 目标文档类型，生成结构化 Markdown 大纲

---

## 触发条件

当用户说出以下类似意图时，激活本 Skill：

- "帮我生成一个大纲"
- "我想写一篇 XX，先给我列个结构"
- "根据这个想法，生成大纲"
- 或由 `/create` 命令内部调用

---

## 输入

本 Skill 需要以下信息（如未提供，按照"缺失信息处理"步骤主动收集）：

| 参数 | 必需 | 说明 |
|------|:----:|------|
| `idea` | 是 | 用户的想法描述，可以是一句话到几段话 |
| `extra_constraints` | 否 | 额外约束，如目标受众、长度限制、特殊章节要求 |
| `output_file` | 否 | 输出文件路径（如 `docs/my-doc.md`）；若提供，大纲生成后立即写入该文件 |
| `max_lines` | 否 | 单文档篇幅上限（行数），默认 `300`；超出时在规模评估中标注"多文件文档树"建议 |

---

## 执行步骤

> **交互原则**：所有需要向用户提问或确认的步骤，**必须使用 `question` 工具**进行交互，不得直接输出文本等待用户回复。

### 步骤 1：解析输入与理解意图

1. 从用户描述中提取核心意图：**主题**、**目的**、**受众**（如能识别）
2. 根据内容性质，自主判断最适合的文档形式（如：技术设计方案、学习笔记、决策记录、操作手册、博客文章等），**不依赖预设模板**
3. 大纲开头通过"文档形式"字段说明判断结果，AI 自主决定结构，无需向用户逐一确认文档类型

### 步骤 2：识别缺失信息

根据用户输入，识别哪些关键信息缺失：

- **文档标题**：是否已知？
- **核心论点/方案**：是否足够清晰？
- **目标受众**：是否已明确？
- **约束条件**：是否有特殊要求？

对于缺失的关键信息，在大纲的"假设清单"中标注，**不阻塞大纲生成**。

### 步骤 3：生成定制化大纲

根据对内容性质的判断，自主设计最合适的章节结构，**不依赖预设模板**。

**大纲生成规则**：

1. **结构自主性**：根据文档的实际用途决定章节组织，同一种内容可以有完全不同的合理结构
2. **必要章节**：识别对当前内容绝对必要的章节，标注 `[必要]`，不可省略
3. **可选章节**：对当前内容有帮助但非必须的章节，标注 `[可选]` 并说明建议包含的理由
4. **子章节**：根据内容复杂度和逻辑关系自行决定是否拆分子章节
5. **内容提示**：每个章节标注"所需输入"和"验收标准"（见输出格式）

### 步骤 3.5：规模评估

> **docs 结构标准**：`maedoc/docs-structure-standard.md §3` 定义了 300 行限制和单文件 vs 多文件的判断规则。

基于已生成的大纲，估算填充后的文档行数，判断最适合的文档形式：

**估算方法**：
- 统计大纲中 H2 章节数量
- 每个 H2 章节（含其子章节、表格、代码块等）估算 40-80 行内容
- 总估算 = 各章节行数之和 + 元信息行数（约 10 行）
- 内容密度高（多代码块、表格、子章节）的章节取上限；概述性章节取下限

**判断规则**：
- 预估总行数 ≤ `max_lines`（默认 300）：`建议形式 = 单文件`
- 预估总行数 > `max_lines`：`建议形式 = 多文件文档树`

**多文件规划**（仅在 `建议形式 = 多文件文档树` 时执行）：

根据大纲章节的**逻辑聚合关系**，将相关章节分组为子文档，设计文档树结构：

1. **入口文档**（`index.md`）：包含系统概述、导航目录、各子文档的摘要链接，预估约 60-80 行
2. **子文档**：每个子文档覆盖 1-3 个紧密相关的 H2 章节，预估控制在 150-250 行；每个子文档能独立阅读、有完整语义
3. 子文档粒度原则：功能/概念上高内聚的章节归一个子文档；可独立成体系的模块各为一个子文档

### 步骤 4：输出大纲并写入文件

按照以下格式输出大纲，然后给出"待确认问题清单"。

**若提供了 `output_file` 参数**：在输出大纲内容后，使用 **`write` 工具**立即将大纲内容写入 `output_file` 指定的文件（若文件不存在则创建，若已存在则覆盖）。写入完成后输出：

```
✅ 大纲已写入：{output_file}
```

---

## 输出格式

```markdown
# 文档大纲：{文档标题或「待确认」}

> **文档形式**：{AI 判断的文档形式，如：技术设计方案、学习笔记、决策记录等}
> **生成时间**：{当前日期}
> **状态**：草稿大纲，待用户确认

---

## 大纲结构

### 1. {章节标题} `[必需]`

**所需输入**：
- {需要用户提供的具体信息，每条一行}

**验收标准**：
- {本章节完成的判断依据，每条一行}

**内容提示**：{基于章节描述和用户想法，给出具体的写作方向建议}

---

### 2. {章节标题} `[必需]`

**所需输入**：
- {信息 1}
- {信息 2}

**验收标准**：
- {标准 1}

**内容提示**：{写作方向}

---

### 3. {章节标题} `[可选]`

> 建议包含原因：{一句话说明为何建议包含此章节}

**所需输入**：
- {信息}

**验收标准**：
- {标准}

**内容提示**：{写作方向}

---

## 假设与待确认事项

| # | 待确认/假设内容 | 影响章节 | 状态 |
|---|----------------|---------|------|
| 1 | {假设或待确认内容} | {章节名} | 待确认 |
| 2 | {假设内容} | {章节名} | 假设 |

---

## 需要用户确认的问题清单

在开始填充内容之前，以下问题需要你的输入：

**必须回答（影响核心结构）**：
1. {问题 1}？
2. {问题 2}？

**可选回答（影响内容深度，跳过则使用假设值）**：
3. {问题 3}？
4. {问题 4}？

---

## 规模评估

| 项目 | 估算 |
|------|------|
| 预估行数 | ~{N} 行 |
| 建议形式 | {单文件 / 多文件文档树} |
| 说明 | {一句话说明：如"主题涵盖 N 个相互独立的模块，单文件预估超出 300 行上限"} |

（以下"建议的文档树结构"**仅在"建议形式 = 多文件文档树"时**输出）

## 建议的文档树结构

docs/{slug}/
├── index.md              # 概览与导航（~{N} 行）
├── {sub-doc-1}.md        # {子文档1标题}（~{N} 行）
├── {sub-doc-2}.md        # {子文档2标题}（~{N} 行）
└── {sub-doc-N}.md        # {子文档N标题}（~{N} 行）

**各子文档范围**：

| 文件名 | 标题 | 覆盖章节（来自大纲） | 预估行数 |
|--------|------|---------------------|---------|
| `index.md` | {主题}概览与导航 | 概述 + 导航目录 | ~{N} |
| `{sub-doc-1}.md` | {子文档1标题} | {大纲章节名，逗号分隔} | ~{N} |
| `{sub-doc-2}.md` | {子文档2标题} | {大纲章节名，逗号分隔} | ~{N} |

---

*确认大纲后，可使用 `doc-content-fill` Skill（单文件）或 `doc-tree-fill` Skill（多文件文档树）填充内容。*
```

---

## 缺失信息处理

| 场景 | 处理方式 |
|------|---------|
| 文档形式无法判断 | AI 自主推断最合理的结构，无需阻塞或向用户确认类型 |
| 标题未指定 | 使用 `[待确认: 文档标题]` 占位，继续生成 |
| 核心内容不清晰 | 生成大纲，在对应章节标注 `[待确认: 需要用户提供...]` |
| 目标受众未知 | 在假设清单中列出，填入合理默认假设 |

**原则**：缺失信息不阻塞大纲生成。优先输出可用的大纲骨架，将待确认事项汇总在文末清单。

---

## 质量标准

生成的大纲应满足：

- [ ] 章节结构符合文档实际用途，逻辑清晰合理
- [ ] 每个章节有明确的"所需输入"和"验收标准"
- [ ] 假设清单列出了所有不确定信息
- [ ] 问题清单区分了"必须回答"和"可选回答"
- [ ] 没有无意义的占位内容（所有提示应具体、可操作）
- [ ] 规模评估已输出，预估行数合理（有明确估算依据）
- [ ] 若建议多文件：文档树结构中每个子文档范围清晰、无重叠，且各自预估行数在 max_lines 以内

---

## 示例

**用户输入**：
> 我想写一篇技术设计文档，介绍我们团队计划引入 Kafka 来替换现有的同步 HTTP 调用，解决服务间耦合问题。

**Skill 行为**：
1. 识别文档性质：技术设计方案（跨服务架构改造）
2. 自主决定章节结构：执行摘要、背景与现状问题、目标与非目标、方案设计、组件与接口定义、数据流、安全考量、测试策略、部署与运维、风险与缓解、里程碑
3. 在"方案设计"章节标注所需输入：现有架构图、涉及服务列表、消息格式定义
4. 输出待确认问题：峰值 QPS 估算、消息持久化策略、消费者组划分方案
