---
name: review
description: 对现有文档进行只读质量审阅——调用 doc-analyst SubAgent 执行 7 维度评估，输出质量报告与改进建议，不修改任何文件。
---

# /review 命令

> **命令**：`/review`
> **版本**：1.0.0
> **用途**：对指定文档执行只读质量审阅，通过 `doc-analyst` SubAgent 输出量化评分和问题清单

---

## 用法

```
/review <文档相对路径>
```

**示例**：

```
/review docs/my-design.md
/review docs/maedoc/system-overview.md
/review
```

---

## 交互原则

> **重要**：所有需要向用户提问或确认的步骤，**必须使用 `question` 工具**进行交互。
>
> **只读命令**：本命令不修改任何文档，仅输出审阅报告。若需修改，引导用户使用 `/iterate`。

---

## 任务意识框架

在本命令执行**全程**，同时运行两种意识模式：

**主线模式**：专注高质量地完成文档审阅，输出可操作的质量报告。

**后台扫描模式**：以"文档生态守护者"的视角，持续留意以下改进信号。每次信号出现时，**即时在心智便签中标记**（不打断主流程，供末尾"TODO 录入"阶段处理）：

- 审阅过程中发现的跨文档问题（本文档引用的其他文档也有问题）
- 文档中的 `[待确认]`/`[假设]` 标注——每处标注即对应一个潜在 TODO
- 文档未被 `docs/index.md` 收录（孤立文档）

---

## 执行流程

### 阶段 0：获取参数

**步骤 0.1：提取命令参数**

命令参数：`$ARGUMENTS`

从参数中提取文档路径。

**步骤 0.2：若未提供文档路径，使用 `question` 工具询问**

- **问题**：请输入要审阅的文档相对路径（如 `docs/my-design.md`）：

**步骤 0.3：验证文件存在**

- 若文件**存在**：继续阶段 1
- 若文件**不存在**：使用 `question` 工具提示并请用户重新输入

---

### 阶段 1：调用 doc-analyst 执行质量评估

使用 `task` 工具调用 `doc-analyst` SubAgent：

- **description**：文档质量审阅
- **subagent_type**：`doc-analyst`
- **prompt**：
  ```
  请对以下文档进行质量分析：{文档的绝对路径}
  读取文档，按你的执行流程完成评分，输出你的标准格式报告。
  ```

等待 doc-analyst 返回结构化质量报告。

---

### 阶段 2：展示审阅报告

解析 doc-analyst 的输出，向用户展示：

```
---

文档审阅报告

文件路径：`{文档路径}`
质量评分：{QUALITY_SCORE}/100 [{等级}]
评估维度：{DIMENSIONS}

主要发现：
{TOP_ISSUES 列表，每条一行}

综合评价：{SUMMARY}

---

建议后续操作：
- 使用 `/iterate {文档路径} <具体反馈>` 修复上述问题
- 使用 `/evolve` 处理跨文档的结构性问题
```

---

### 阶段 3：TODO 录入（必做）

**步骤 1：回顾心智便签，逐条判断以下具体触发线索**

| # | 本次执行的具体线索 | 结论 |
|---|---|:---:|
| 1 | 审阅报告中存在 P0 或 P1 问题？ | 是 / 否 |
| 2 | 文档中存在未处理的 `[待确认]`/`[假设]` 标注？ | 是 / 否 |
| 3 | 审阅过程中发现引用的其他文档也需要更新？ | 是 / 否 |
| 4 | 文档未被 `docs/index.md` 收录？ | 是 / 否 |

**步骤 2：对每个"是"项执行**

1. 读取 `.opencode/skills/todo-append/SKILL.md`
2. 按 Skill 步骤将事项追加到 `docs/TODO.md`
3. 在完成摘要中记录编号

**步骤 3：完成声明（必须出现在完成摘要中，二选一）**

- **有 TODO 记录**：列出所有已记录编号
- **零 TODO**：对上表 4 条线索，每条用一句话说明为何未触发

---

## 错误处理

| 错误场景 | 处理方式 |
|---------|---------|
| 文件路径不存在 | 使用 `question` 工具提示，请用户重新输入 |
| 文档内容为空 | 提示"文档为空，无法审阅"，建议使用 `/create` |
| doc-analyst SubAgent 超时 | 提示用户，建议稍后重试 |

---

## 流程图

```
/review <文档路径>
    |
    v
[阶段 0] 提取文档路径
    | 若路径为空 -> question 工具询问 -> 验证文件存在
    v
[阶段 1] task 工具调用 doc-analyst SubAgent
    | doc-analyst 在独立上下文中：
    |   读取文档 -> 执行 doc-evaluate Skill -> 输出质量报告
    v
[阶段 2] 展示审阅报告（评分 + 问题 + 建议）
    v
[阶段 3] TODO 录入（必做）
    |   有 P0/P1 -> 读取 todo-append SKILL.md -> 追加 TODO
    |   无项 -> 逐条说明为何未触发
```

---

## 注意事项

1. **只读命令**：本命令不修改任何文档，审阅报告仅供参考
2. **独立评估**：通过 doc-analyst SubAgent 在独立上下文中评估，避免主 Agent 的认知偏见
3. **可重复执行**：同一文档可多次审阅，追踪质量变化
4. **与 /iterate 配合**：审阅发现问题后，使用 `/iterate` 进行定向修复
