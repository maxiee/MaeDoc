# OpenCode æ‰©å±•å¼€å‘å®‰å…¨è¾¹ç•Œ

> **æ‰€å±ç³»åˆ—**ï¼š[OpenCode ä½¿ç”¨æŒ‡å—](../index.md) â†’ [æ‰©å±•èƒ½åŠ›](./index.md)
> **æœ€åæ›´æ–°**ï¼š2026-02-22

---

## æ¦‚è¿°

OpenCode çš„æ‰©å±•èƒ½åŠ›ï¼ˆPluginsã€Toolsã€MCPã€Serverï¼‰å…·æœ‰å¼ºå¤§çš„ç³»ç»Ÿè®¿é—®æƒé™ã€‚**å®‰å…¨è¾¹ç•Œ**æ˜¯æ‰©å±•è®¾è®¡çš„æ ¸å¿ƒè€ƒé‡ï¼Œå¿…é¡»åœ¨å¼€å‘å’Œä½¿ç”¨æ—¶æ—¶åˆ»å…³æ³¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenCode Runtime                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Plugins â”‚  â”‚  Tools  â”‚  â”‚   MCP   â”‚  â”‚ Server  â”‚    â”‚
â”‚  â”‚  å…¨æƒé™  â”‚  â”‚  å…¨æƒé™  â”‚  â”‚  é…ç½®æƒ  â”‚  â”‚  æš´éœ²æƒ  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚            â”‚            â”‚            â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                          â”‚                               â”‚
â”‚                          â–¼                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚    å®‰å…¨è¾¹ç•Œæ£€æŸ¥ç‚¹    â”‚                    â”‚
â”‚              â”‚  â€¢ æƒé™éªŒè¯          â”‚                    â”‚
â”‚              â”‚  â€¢ æ²™ç®±éš”ç¦»          â”‚                    â”‚
â”‚              â”‚  â€¢ å®¡è®¡æ—¥å¿—          â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®‰å…¨é£é™©ç­‰çº§

### é£é™©çŸ©é˜µ

| æ‰©å±•ç±»å‹ | æ–‡ä»¶è®¿é—® | å‘½ä»¤æ‰§è¡Œ | ç½‘ç»œè®¿é—® | é£é™©ç­‰çº§ |
|---------|:--------:|:--------:|:--------:|:--------:|
| Skills | âŒ | âŒ | âŒ | ğŸŸ¢ ä½ |
| Plugins | âœ“ | âœ“ | âœ“ | ğŸ”´ é«˜ |
| Custom Tools | âœ“ | âœ“ | âœ“ | ğŸ”´ é«˜ |
| MCP Servers | é…ç½®é™å®š | é…ç½®é™å®š | âœ“ | ğŸŸ¡ ä¸­ |
| Server API | âœ“ | âœ“ | â€” | ğŸ”´ é«˜ |

---

## å®‰å…¨æ£€æŸ¥æ¸…å•

### 1. æƒé™æœ€å°åŒ–

```jsonc
// âœ… æ­£ç¡®ï¼šåªæˆäºˆå¿…è¦æƒé™
{
  "permission": {
    "tool": {
      "my-tool": "ask"
    },
    "mcp": {
      "filesystem": {
        "read": "allow",
        "write": "ask",
        "delete": "deny"
      }
    }
  }
}

// âŒ é”™è¯¯ï¼šè¿‡åº¦æˆæƒ
{
  "permission": {
    "tool": { "*": "allow" },
    "mcp": { "*": "allow" }
  }
}
```

### 2. æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤

```jsonc
{
  "rules": {
    "protected-files": {
      "pattern": [
        ".env*",
        "*.key",
        "*.pem",
        "credentials.*",
        "secrets.*"
      ],
      "actions": {
        "read": "deny",
        "edit": "deny"
      }
    }
  }
}
```

### 3. ç½‘ç»œè®¿é—®æ§åˆ¶

```jsonc
{
  "network": {
    "allowedDomains": [
      "api.anthropic.com",
      "api.openai.com"
    ],
    "denyDomains": [
      "internal.company.com"
    ]
  }
}
```

### 4. Server æš´éœ²æ§åˆ¶

```jsonc
// âœ… æ­£ç¡®ï¼šä»…æœ¬åœ°è®¿é—®
{
  "server": {
    "host": "127.0.0.1",
    "port": 3000
  }
}

// âŒ é”™è¯¯ï¼šå…¬ç½‘æš´éœ²
{
  "server": {
    "host": "0.0.0.0"  // å±é™©ï¼
  }
}
```

---

## CORS ä¸ç«¯å£æš´éœ²

### CORS é…ç½®åŸåˆ™

```jsonc
{
  "server": {
    "cors": {
      // âœ… æ­£ç¡®ï¼šæ˜ç¡®æŒ‡å®šå…è®¸çš„æº
      "origins": ["http://localhost:5173"],
      
      // âŒ é”™è¯¯ï¼šå…è®¸æ‰€æœ‰æº
      // "origins": ["*"]
      
      "credentials": false  // é™¤éå¿…è¦ï¼Œä¸å¯ç”¨å‡­è¯
    }
  }
}
```

### ç«¯å£æš´éœ²å†³ç­–æ ‘

```
æ˜¯å¦éœ€è¦è¿œç¨‹è®¿é—®ï¼Ÿ
â”œâ”€ å¦ â†’ åªç›‘å¬ 127.0.0.1 âœ“
â””â”€ æ˜¯ 
    â”œâ”€ æ˜¯å¦éœ€è¦å…¬ç½‘è®¿é—®ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ VPN/Tunnelï¼ˆå¦‚ Tailscaleï¼‰âœ“
    â”‚   â””â”€ å¦ â†’ ä½¿ç”¨åå‘ä»£ç† + è®¤è¯ âœ“
    â”‚
    â””â”€ åˆ‡å‹¿ç›´æ¥ç»‘å®š 0.0.0.0ï¼âœ—
```

---

## å·¥ä½œåŒºä¿¡ä»»

### ä¿¡ä»»ç­‰çº§

| ç­‰çº§ | è¯´æ˜ | å»ºè®®æ“ä½œ |
|------|------|---------|
| **å—ä¿¡ä»»** | ä¸ªäººé¡¹ç›®ã€ç»è¿‡å®¡è®¡çš„ä»£ç  | å…è®¸å¤§éƒ¨åˆ†æ“ä½œ |
| **éƒ¨åˆ†ä¿¡ä»»** | å¼€æºé¡¹ç›®ã€å›¢é˜Ÿé¡¹ç›® | æ•æ„Ÿæ“ä½œéœ€ç¡®è®¤ |
| **ä¸ä¿¡ä»»** | ä¸‹è½½çš„ä»£ç ã€æœªçŸ¥æ¥æº | é™åˆ¶æƒé™ï¼Œåªè¯»æ¨¡å¼ |

### é…ç½®ç¤ºä¾‹

```jsonc
{
  "workspace": {
    "trust": "partial",
    "restrictions": {
      "bash": "ask",
      "edit": "ask",
      "network": "deny"
    }
  }
}
```

---

## å®¡è®¡æ—¥å¿—

### å¯ç”¨å®¡è®¡

```jsonc
{
  "audit": {
    "enabled": true,
    "logLevel": "all",
    "logFile": "~/.config/opencode/audit.log",
    "events": [
      "tool:execute",
      "file:read",
      "file:edit",
      "bash:execute",
      "mcp:call"
    ]
  }
}
```

### æ—¥å¿—æ ¼å¼

```
[2026-02-22 14:30:15] TOOL_EXECUTE | tool=run_script | params={"command":"ls"} | result=success
[2026-02-22 14:30:20] FILE_EDIT | path=./src/index.ts | operation=write | result=success
[2026-02-22 14:30:25] BASH_EXECUTE | command="npm install" | result=success
```

---

## å®‰å…¨å¼€å‘å®è·µ

### Plugin/Tool å¼€å‘

```typescript
// âœ… æ­£ç¡®ï¼šè¾“å…¥éªŒè¯
export async function execute(params: unknown) {
  if (!isValidParams(params)) {
    throw new Error('Invalid parameters');
  }
  
  // æ£€æŸ¥è·¯å¾„æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
  if (!isPathAllowed(params.path)) {
    throw new Error('Path access denied');
  }
  
  return doWork(params);
}

// âŒ é”™è¯¯ï¼šç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥
export async function execute(params: any) {
  return eval(params.code);  // æå…¶å±é™©ï¼
}
```

### MCP Server å¼€å‘

```typescript
// âœ… æ­£ç¡®ï¼šé™åˆ¶èµ„æºè®¿é—®
server.resource('file', 'file://allowed/*', async (uri) => {
  const path = parseUri(uri);
  
  if (!path.startsWith('/allowed/')) {
    throw new Error('Access denied');
  }
  
  return readFile(path);
});
```

---

## åº”æ€¥å“åº”

### å‘ç°å®‰å…¨é—®é¢˜æ—¶

1. **ç«‹å³åœæ­¢** Server æœåŠ¡
2. **å®¡è®¡æ—¥å¿—** æ£€æŸ¥æ˜¯å¦æœ‰æœªæˆæƒæ“ä½œ
3. **è½®æ¢å‡­è¯** æ›´æ–°æ‰€æœ‰å¯èƒ½æ³„éœ²çš„ API Key
4. **éš”ç¦»ç¯å¢ƒ** å°†å—å½±å“çš„å·¥ä½œåŒºéš”ç¦»

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥æ‰¾å¯ç–‘æ“ä½œ
grep -E "(DELETE|DROP|rm -rf)" ~/.config/opencode/audit.log

# æŸ¥æ‰¾ç½‘ç»œè®¿é—®
grep "network" ~/.config/opencode/audit.log
```

---

## å®‰å…¨è¾¹ç•Œé€ŸæŸ¥è¡¨

| åœºæ™¯ | å®‰å…¨ç­–ç•¥ |
|------|---------|
| å¼€å‘æµ‹è¯• | åªç›‘å¬ localhostï¼Œå¯ç”¨å®¡è®¡ |
| å›¢é˜Ÿå…±äº« | ä½¿ç”¨ VPNï¼Œé…ç½®è®¤è¯ |
| ç”Ÿäº§éƒ¨ç½² | åå‘ä»£ç† + HTTPS + è®¤è¯ |
| å¼€æºé¡¹ç›® | ä¸ä¿¡ä»»æ¨¡å¼ï¼Œé™åˆ¶æƒé™ |
| æ•æ„Ÿé¡¹ç›® | ç¦ç”¨ç½‘ç»œï¼Œåªè¯»æ¨¡å¼ |

---

## ç›¸å…³æ–‡æ¡£

- [Plugins æ‰©å±•æœºåˆ¶](./plugins.md)
- [Custom Tools](./custom-tools.md)
- [MCP Servers](./mcp-servers.md)
- [Server/SDK](./server-sdk.md)

---

*æœ¬æ–‡æ¡£æ˜¯ OpenCode æ‰©å±•å¼€å‘çš„å®‰å…¨æŒ‡å—ï¼Œæœ€åæ›´æ–°ï¼š2026-02-22*
