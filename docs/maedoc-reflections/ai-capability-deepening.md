# AI 能力深化：未来演进的核心方向

> **本文档定位**：探讨如何让 MaeDoc 的 AI 能力更强，聚焦「本地模型强化」和「本地-远程协作」
> **阅读建议**：本章是演进路线图的理论基础，建议与下一章对照阅读

---

## 1. 引言：为什么是「AI 能力深化」

在前面的章节中，我们分析了很多痛点。这些痛点的共同点是：**它们很大程度上受限于 AI 的能力边界**。

- 交互摩擦 → AI 理解意图不够准确，需要多轮确认
- 质量把控 → AI 生成的内容质量不够稳定
- 上下文断裂 → AI 的上下文窗口有限
- 迭代成本 → AI 对「修改意图」的理解不够精准

如果 AI 能力更强，这些痛点会自然缓解。

所以，「AI 能力深化」不是锦上添花，而是**解决根本问题**。

---

## 2. 什么是「AI 能力深化」

具体来说，我希望 MaeDoc 的 AI 在以下方面更强：

### 2.1 上下文理解

**当前状态**：AI 能理解单个文档，但对整个文档库的理解是割裂的。

**期望状态**：AI 能够：
- 理解文档之间的关联关系
- 在生成新内容时，自动引用已有内容
- 检测并避免与已有内容矛盾

### 2.2 推理深度

**当前状态**：AI 的推理相对浅层，容易给出「看起来对但实际有问题」的建议。

**期望状态**：AI 能够：
- 进行多步骤推理，识别潜在问题
- 提供论证过程，而非只有结论
- 主动指出假设和限制条件

### 2.3 自我改进

**当前状态**：AI 不会从用户的修改中学习。

**期望状态**：AI 能够：
- 记住用户的偏好和修改习惯
- 从历史交互中提取模式
- 逐步提高对特定用户/项目的适配度

### 2.4 能力边界认知

**当前状态**：AI 对自己的能力边界判断不够准确。

**期望状态**：AI 能够：
- 准确评估自己的置信度
- 在不确定时主动说明
- 知道什么时候该求助

---

## 3. 本地模型的强化路径

MaeDoc 的设计理念是「本地优先」。因此，AI 能力深化的核心是**让本地模型更强**。

### 3.1 当前本地模型的能力评估

以 Ollama + Llama 3.1 为例，它在文档写作场景下的表现：

| 能力 | 评分 | 说明 |
|------|:----:|------|
| 基础写作 | ⭐⭐⭐⭐ | 能生成流畅的文本，偶尔有语法问题 |
| 结构规划 | ⭐⭐⭐ | 能生成合理的大纲，但有时过于通用 |
| 领域知识 | ⭐⭐ | 对技术领域有一定了解，但深度不够 |
| 上下文记忆 | ⭐⭐ | 能记住 4-8k token，但对长文档会遗忘 |
| 推理能力 | ⭐⭐ | 能做简单推理，复杂推理容易出错 |
| 自我评估 | ⭐ | 几乎没有自我评估能力 |

### 3.2 强化方向

#### 方向 1：RAG（检索增强生成）

**原理**：在生成内容前，先从文档库中检索相关信息，作为上下文传入。

**适用场景**：
- 跨文档引用
- 保持术语一致性
- 避免内容矛盾

**实现挑战**：
- 需要建立高效的向量索引
- 检索的精确度影响生成质量
- 增加了系统复杂度

**投入产出比**：⭐⭐⭐⭐（高）

#### 方向 2：提示工程优化

**原理**：通过优化提示词，引导模型生成更好的输出。

**适用场景**：
- 大纲生成
- 内容填充
- 质量审阅

**实现挑战**：
- 提示词需要持续调优
- 不同模型对提示词的响应不同
- 提示词过长会占用上下文窗口

**投入产出比**：⭐⭐⭐⭐⭐（最高）

#### 方向 3：微调（Fine-tuning）

**原理**：使用特定领域的数据对模型进行微调，使其更适合文档写作场景。

**适用场景**：
- 特定文档类型的写作风格
- 领域专业知识的注入
- 用户偏好的固化

**实现挑战**：
- 需要高质量的训练数据
- 微调成本较高（时间和计算资源）
- 可能导致模型泛化能力下降

**投入产出比**：⭐⭐⭐（中）

#### 方向 4：多模型协作

**原理**：使用多个小型模型分工协作，每个模型负责特定任务。

**适用场景**：
- 大纲生成用一个模型
- 内容填充用另一个模型
- 质量审阅用第三个模型

**实现挑战**：
- 需要设计模型间的协作协议
- 增加了系统复杂度
- 模型间的一致性需要保证

**投入产出比**：⭐⭐（低，复杂度高）

### 3.3 推荐的实施优先级

1. **短期（1-2 周）**：提示工程优化
   - 优化各 Skill 的提示词
   - 建立提示词版本管理
   - A/B 测试不同提示词的效果

2. **中期（1-2 月）**：RAG 集成
   - 集成向量数据库（如 Chroma、Qdrant）
   - 实现文档索引和检索
   - 在 Skills 中使用检索结果

3. **长期（3-6 月）**：微调探索
   - 收集用户写作数据
   - 评估微调的必要性
   - 如果决定微调，选择合适的基座模型

---

## 4. 本地与远程的协同进化

虽然本地模型是核心，但远程模型（Claude、GPT-4 等）仍然有价值。关键是如何设计协作模式。

### 4.1 当前协作模式的问题

当前的 `.docforge` 中继协议是「手动触发 + 手动应用」。这种模式：
- 用户体验差（复制粘贴繁琐）
- 无法实时协作
- 缺乏上下文同步

### 4.2 理想的协作模式

**模式 1：自动升级**

当本地模型判断自己无法处理时，自动将请求升级到远程模型。用户可以选择：
- 预先授权：允许自动升级
- 逐次确认：每次升级前询问

**模式 2：混合处理**

本地模型负责大部分工作，远程模型负责「关键时刻」：
- 本地：大纲生成、内容填充
- 远程：复杂推理、专业审阅

**模式 3：无缝切换**

用户无感知地在本地和远程之间切换。AI 根据任务复杂度自动选择最合适的模型。

### 4.3 协作模式的技术挑战

**挑战 1：API Key 管理**

如果支持自动调用远程 API，需要安全地存储和管理 API Key。

**可能的解决方案**：
- 使用系统 Keychain
- 环境变量注入
- 每次使用时手动输入

**挑战 2：成本控制**

远程 API 调用有成本。需要机制防止意外的大量调用。

**可能的解决方案**：
- 设置调用频率限制
- 设置成本上限
- 提供使用量统计

**挑战 3：隐私保护**

自动调用远程 API 意味着内容会发送到第三方服务。

**可能的解决方案**：
- 明确的隐私策略
- 敏感内容过滤
- 用户可控的发送范围

### 4.4 推荐的演进路径

1. **第一阶段**：保持文件中继，优化交互
   - 改进 `/escalate` 的体验
   - 优化上报包的格式
   - 改进 `/ingest-remote` 的建议分类

2. **第二阶段**：引入可选的 API 集成
   - 支持配置 API Key
   - 提供手动触发 API 调用的命令
   - 用户可以选择使用或不使用

3. **第三阶段**：自动升级机制
   - AI 判断是否需要升级
   - 用户预先授权或逐次确认
   - 成本和隐私控制

---

## 5. 能力边界认知的提升

「知道自己不知道」是 AI 安全和可靠性的关键。

### 5.1 当前的做法

通过 `hardness-classify` Skill 和 AGENTS.md §8 的主动求助规则，MaeDoc 已经有了初步的能力边界认知机制。

但这个机制还不够精准：
- 有时候过于保守（可以回答的问题也触发求助）
- 有时候过于自信（给出低质量回答）

### 5.2 提升方向

#### 方向 1：置信度量化

在 AI 输出中显式标注置信度：

```markdown
## 架构建议

基于你的描述，我建议采用微服务架构。

**置信度**：⭐⭐⭐ (3/5)

**理由**：
- 你的系统有明确的模块边界 [HIGH]
- 但我没有足够信息判断流量规模 [LOW]
```

这样用户对 AI 的判断有感知，可以决定是否需要进一步验证。

#### 方向 2：不确定性显式化

当 AI 不确定时，明确说明不确定的部分：

```markdown
## 性能优化建议

以下是可能的优化方向：

1. 数据库索引优化 [确定]
2. 缓存策略调整 [确定]
3. 查询语句重写 [不确定 - 需要查看实际 SQL]
4. 分库分表 [高度不确定 - 需要先评估数据量]
```

#### 方向 3：基于历史的校准

记录 AI 的判断和实际结果，用于校准置信度：

- AI 判断 [HIGH]，用户采纳 → 校准为更高置信
- AI 判断 [HIGH]，用户大幅修改 → 校准为更低置信

这需要一个「反馈收集」机制。

### 5.3 实施建议

1. **短期**：在关键输出中添加置信度标注（大纲、重要建议）
2. **中期**：建立不确定性标记的规范
3. **长期**：引入基于历史的置信度校准系统

---

## 6. 小结：AI 能力深化的路线图

| 阶段 | 重点 | 关键产出 |
|------|------|---------|
| 短期（1-2 周） | 提示工程优化 | 优化后的 Skills、提示词版本管理 |
| 中期（1-2 月） | RAG 集成 | 向量索引、跨文档检索 |
| 长期（3-6 月） | 协作模式优化 | 自动升级机制、置信度校准 |

AI 能力深化是一个持续的过程，不可能一蹴而就。关键是：
1. 每次改进都要有明确的度量
2. 保持向后兼容
3. 用户可以选择是否启用新能力

下一章，我们将把这些想法转化为具体的版本规划。

---

*本章最后更新：2026-02-21*
