{
  "$schema": "../../schemas/doc-type.schema.v1.json",
  "type_id": "tech-design",
  "name": "技术设计文档",
  "description": "用于系统架构与技术方案设计。适用场景：新系统/服务设计、重大功能变更、架构演进方案、技术选型决策。是工程师对齐技术方向、评审技术决策的核心文档。",
  "version": "1.0.0",
  "author": "MaeDoc",
  "tags": ["technical", "architecture", "design", "engineering"],
  "sections": [
    {
      "id": "executive-summary",
      "title": "执行摘要",
      "required": true,
      "description": "面向决策者的一页纸摘要。用 3-5 句话说清楚：做什么、为什么做、核心方案是什么、预期影响。读者无需阅读全文即可做出是否推进的判断。",
      "subsections": []
    },
    {
      "id": "background-and-problem",
      "title": "背景与问题陈述",
      "required": true,
      "description": "阐明当前状态与期望状态之间的差距，以及不解决该问题的代价。",
      "subsections": [
        {
          "id": "background",
          "title": "背景",
          "required": true,
          "description": "描述触发本设计的上下文：业务驱动力、现有系统状态、相关历史决策。聚焦事实，避免引入解决方案。"
        },
        {
          "id": "problem-statement",
          "title": "问题陈述",
          "required": true,
          "description": "用数据或可观察现象定义核心问题。明确问题的范围和严重性。示例格式：当前 X 导致 Y，影响范围为 Z。"
        }
      ]
    },
    {
      "id": "goals-and-non-goals",
      "title": "目标与非目标",
      "required": true,
      "description": "明确划定本方案的边界，防止范围蔓延，帮助评审人快速判断方案是否聚焦。",
      "subsections": [
        {
          "id": "goals",
          "title": "目标",
          "required": true,
          "description": "列出本方案要解决的问题和达成的可验证指标。每条目标应满足 SMART 原则（可量化、有时限）。"
        },
        {
          "id": "non-goals",
          "title": "非目标",
          "required": true,
          "description": "明确列出本方案刻意不解决的问题。非目标与目标同等重要——它们共同定义了方案边界。"
        }
      ]
    },
    {
      "id": "architecture",
      "title": "架构设计",
      "required": true,
      "description": "系统整体架构的结构化描述，包含可视化图表和关键设计决策的理由。",
      "subsections": [
        {
          "id": "architecture-overview",
          "title": "架构总览",
          "required": true,
          "description": "用 Mermaid 图（优先使用 C4 模型或分层架构图）展示系统整体结构。图表后附简短文字说明核心设计决策及其理由。"
        },
        {
          "id": "component-list",
          "title": "组件清单",
          "required": true,
          "description": "以表格形式列出所有关键组件：组件名称、职责描述、技术选型、与其他组件的依赖关系。"
        },
        {
          "id": "data-flow-and-interfaces",
          "title": "数据流与接口定义",
          "required": false,
          "description": "描述组件间的数据流转路径和关键接口契约。可包含：序列图（Mermaid sequence）、API 签名、消息格式、数据库 Schema 要点。"
        }
      ]
    },
    {
      "id": "security-and-privacy",
      "title": "安全与隐私考量",
      "required": true,
      "description": "系统性分析本方案引入的安全风险和隐私影响，以及对应的缓解措施。不可省略，即使结论是"无新增风险"也需明确写出。",
      "subsections": [
        {
          "id": "threat-model",
          "title": "威胁模型",
          "required": false,
          "description": "识别主要威胁面（STRIDE 框架可选）：身份欺骗、篡改、否认、信息泄露、拒绝服务、提权。列出每类威胁的可能场景和影响等级。"
        },
        {
          "id": "security-controls",
          "title": "安全控制措施",
          "required": true,
          "description": "列出已设计或计划实施的安全控制：认证/鉴权机制、传输加密、数据加密、审计日志、输入验证等。"
        },
        {
          "id": "privacy-impact",
          "title": "隐私影响",
          "required": false,
          "description": "说明是否涉及个人数据（PII）处理。如涉及，描述数据最小化、留存策略、用户知情同意机制。"
        }
      ]
    },
    {
      "id": "testing-strategy",
      "title": "测试策略",
      "required": true,
      "description": "定义如何验证方案的正确性和健壮性，覆盖从单元测试到生产验证的完整策略。",
      "subsections": [
        {
          "id": "test-levels",
          "title": "测试层次",
          "required": true,
          "description": "描述各层测试的覆盖范围：单元测试、集成测试、端到端测试、性能测试、混沌测试（如适用）。"
        },
        {
          "id": "acceptance-criteria",
          "title": "验收标准",
          "required": true,
          "description": "列出可量化的验收条件，作为功能完成的判定依据。格式：给定 X 条件，当 Y 发生时，系统应 Z。"
        }
      ]
    },
    {
      "id": "deployment-and-ops",
      "title": "部署与运维",
      "required": false,
      "description": "描述系统的部署方式和运维策略，确保工程团队能独立完成上线和日常运维。",
      "subsections": [
        {
          "id": "deployment-plan",
          "title": "部署方案",
          "required": false,
          "description": "说明部署环境、发布策略（蓝绿/金丝雀/滚动）、依赖基础设施、配置管理方式。"
        },
        {
          "id": "observability",
          "title": "可观测性",
          "required": false,
          "description": "定义关键监控指标（SLI/SLO）、告警阈值、日志结构、链路追踪策略。"
        },
        {
          "id": "rollback-plan",
          "title": "回滚方案",
          "required": false,
          "description": "描述出现问题时的回滚触发条件、步骤和恢复时间目标（RTO）。"
        }
      ]
    },
    {
      "id": "risks-and-mitigations",
      "title": "风险与缓解",
      "required": true,
      "description": "系统性识别本方案面临的技术、工程、组织层面的风险，并给出缓解或接受策略。以风险矩阵（可能性 × 影响）组织。",
      "subsections": []
    },
    {
      "id": "milestones-and-schedule",
      "title": "里程碑与排期",
      "required": false,
      "description": "将方案分解为可交付的阶段性里程碑，标注预期时间和交付物。信息未知时标注为"未指定"。",
      "subsections": []
    },
    {
      "id": "assumptions-and-unspecified",
      "title": "未指定项与假设清单",
      "required": true,
      "description": "集中列出所有待确认的假设、未决策的技术选项、需要外部输入的信息。作为本文档的"TODO"跟踪器，在评审时重点关注。",
      "subsections": []
    },
    {
      "id": "appendix",
      "title": "附录",
      "required": false,
      "description": "补充材料：参考文档、相关 ADR 链接、术语表、历史方案对比等。",
      "subsections": [
        {
          "id": "references",
          "title": "参考资料",
          "required": false,
          "description": "列出本文档引用的外部资料，包括技术规范、相关设计文档、RFC、工具文档。"
        },
        {
          "id": "alternatives-considered",
          "title": "备选方案",
          "required": false,
          "description": "记录已评估但未采用的方案及其放弃原因，作为决策历史留存，避免日后重复讨论。"
        },
        {
          "id": "glossary",
          "title": "术语表",
          "required": false,
          "description": "定义文档中使用的专业术语、系统内部名词和缩写，降低阅读门槛。"
        }
      ]
    }
  ],
  "variables": {
    "project_name": {
      "type": "string",
      "required": true,
      "description": "项目或系统的名称",
      "examples": ["订单服务重构", "实时消息推送系统", "用户权限中心"]
    },
    "author": {
      "type": "string",
      "required": false,
      "description": "文档作者姓名",
      "default": "未指定"
    },
    "date": {
      "type": "string",
      "required": false,
      "description": "文档日期，格式 YYYY-MM-DD",
      "default": "未指定"
    },
    "version": {
      "type": "string",
      "required": false,
      "description": "文档版本号",
      "default": "1.0.0"
    },
    "status": {
      "type": "string",
      "required": false,
      "description": "文档状态：草稿 / 评审中 / 已批准 / 已废弃",
      "default": "草稿"
    },
    "reviewers": {
      "type": "string",
      "required": false,
      "description": "评审人列表，逗号分隔",
      "default": "未指定"
    }
  },
  "writing_guidelines": "guidelines.md",
  "output_format": "markdown"
}
